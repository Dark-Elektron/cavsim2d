<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cavsim2d.utils.shared_functions &mdash; cavsim2d 13.08.2024 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css?v=7f9a90b1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=f5513fb5"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            cavsim2d
              <img src="../../../_static/cavsim2d_logo_2x.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html#examples">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html#understanding-the-geometry-types">Understanding the geometry types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html#advanced">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html#parallelisation">Parallelisation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">cavsim2d</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">cavsim2d</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">cavsim2d.utils.shared_functions</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for cavsim2d.utils.shared_functions</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Ellipse</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">cavsim2d.utils.printing</span> <span class="kn">import</span> <span class="o">*</span>


<div class="viewcode-block" id="update_alpha">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.update_alpha">[docs]</a>
<span class="k">def</span> <span class="nf">update_alpha</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">cell_parameterisation</span><span class="o">=</span><span class="s1">&#39;simplecell&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update geometry json file variables to include the value of alpha</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cell:</span>
<span class="sd">        Cavity geometry parameters</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List of cavity geometry parameters</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">calculate_alpha</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cell_parameterisation</span> <span class="o">==</span> <span class="s1">&#39;simplecell&#39;</span><span class="p">:</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">cell</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span></div>



<div class="viewcode-block" id="calculate_alpha">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.calculate_alpha">[docs]</a>
<span class="k">def</span> <span class="nf">calculate_alpha</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">L_bp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the largest angle the tangent line of two ellipses makes with the horizontal axis</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A: float</span>
<span class="sd">    B: float</span>
<span class="sd">    a: float</span>
<span class="sd">    b: float</span>
<span class="sd">    Ri: float</span>
<span class="sd">    L: float</span>
<span class="sd">    Req: float</span>
<span class="sd">    L_bp: float</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    alpha: float</span>
<span class="sd">        Largest angle the tangent line of two ellipses makes with the horizontal axis</span>
<span class="sd">    error_msg: int</span>
<span class="sd">        State of the iteration, failed or successful. Refer to</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">L_bp</span><span class="p">)</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">return</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">error_msg</span></div>



<div class="viewcode-block" id="tangent_coords">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.tangent_coords">[docs]</a>
<span class="k">def</span> <span class="nf">tangent_coords</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">L_bp</span><span class="p">,</span> <span class="n">lft</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tangent_check</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls to :py:func:`utils.shared_function.ellipse_tangent`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A: float</span>
<span class="sd">        Equator ellipse dimension</span>
<span class="sd">    B: float</span>
<span class="sd">        Equator ellipse dimension</span>
<span class="sd">    a: float</span>
<span class="sd">        Iris ellipse dimension</span>
<span class="sd">    b: float</span>
<span class="sd">        Iris ellipse dimension</span>
<span class="sd">    Ri: float</span>
<span class="sd">        Iris radius</span>
<span class="sd">    L: float</span>
<span class="sd">        Cavity half cell length</span>
<span class="sd">    Req: float</span>
<span class="sd">        Cavity equator radius</span>
<span class="sd">    L_bp: float</span>
<span class="sd">        Cavity beampipe length</span>
<span class="sd">    tangent_check: bool</span>
<span class="sd">        If set to True, the calculated tangent line as well as the ellipses are plotted and shown</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df: pandas.Dataframe</span>
<span class="sd">        Pandas dataframe containing information on the results from fsolve</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># data = ([0 + L_bp, Ri + b, L + L_bp, Req - B],</span>
    <span class="c1">#         [a, b, A, B])  # data = ([h, k, p, q], [a_m, b_m, A_m, B_m])</span>
    <span class="c1">#</span>
    <span class="c1"># df = fsolve(ellipse_tangent,</span>
    <span class="c1">#             np.array([a + L_bp, Ri + f[0] * b, L - A + L_bp, Req - f[1] * B]),</span>
    <span class="c1">#             args=data, fprime=jac, xtol=1.49012e-12, full_output=True)</span>
    <span class="c1">#</span>
    <span class="c1">#     # ic(df)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">([</span><span class="mi">0</span> <span class="o">+</span> <span class="n">L_bp</span><span class="p">,</span> <span class="n">Ri</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">L</span> <span class="o">+</span> <span class="n">L_bp</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B</span><span class="p">],</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">])</span>  <span class="c1"># data = ([h, k, p, q], [a_m, b_m, A_m, B_m])</span>
    <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;non-reentrant&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">],</span>
              <span class="s2">&quot;reentrant&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.85</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.85</span><span class="p">],</span>
              <span class="s2">&quot;expansion&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.15</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">]}</span>

    <span class="n">max_restart</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;non-reentrant&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.75</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">]],</span>
              <span class="s2">&quot;reentrant&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">1.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.75</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.75</span><span class="p">],</span> <span class="p">]</span>
              <span class="p">}</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_restart</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">+</span> <span class="n">A</span> <span class="o">&gt;</span> <span class="n">L</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">ellipse_tangent</span><span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span> <span class="o">+</span> <span class="n">L_bp</span><span class="p">,</span> <span class="n">Ri</span> <span class="o">+</span> <span class="n">checks</span><span class="p">[</span><span class="s1">&#39;reentrant&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="n">L</span> <span class="o">-</span> <span class="n">A</span> <span class="o">+</span> <span class="n">L_bp</span><span class="p">,</span>
                                      <span class="n">Req</span> <span class="o">+</span> <span class="n">checks</span><span class="p">[</span><span class="s1">&#39;reentrant&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">]),</span>
                            <span class="n">args</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">fprime</span><span class="o">=</span><span class="n">jac</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1.49012e-12</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">ellipse_tangent</span><span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span> <span class="o">+</span> <span class="n">L_bp</span><span class="p">,</span> <span class="n">Ri</span> <span class="o">+</span> <span class="n">checks</span><span class="p">[</span><span class="s1">&#39;non-reentrant&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="n">L</span> <span class="o">-</span> <span class="n">A</span> <span class="o">+</span> <span class="n">L_bp</span><span class="p">,</span>
                                      <span class="n">Req</span> <span class="o">+</span> <span class="n">checks</span><span class="p">[</span><span class="s1">&#39;non-reentrant&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">]),</span>
                            <span class="n">args</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">fprime</span><span class="o">=</span><span class="n">jac</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1.49012e-12</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">if</span> <span class="n">tangent_check</span><span class="p">:</span>
        <span class="n">shift_x</span> <span class="o">=</span> <span class="o">-</span><span class="n">L</span> <span class="o">-</span> <span class="n">lft</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">el_ab</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="n">shift_x</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">el_AB</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="n">shift_x</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">A</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">B</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">el_ab</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">el_AB</span><span class="p">)</span>

        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">shift_x</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">shift_x</span> <span class="o">+</span> <span class="n">x2</span><span class="p">],</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">:: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">df</span></div>



<div class="viewcode-block" id="ellipse_tangent">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.ellipse_tangent">[docs]</a>
<span class="k">def</span> <span class="nf">ellipse_tangent</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="o">*</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the coordinates of the tangent line that connects two ellipses</span>

<span class="sd">    .. _ellipse tangent:</span>

<span class="sd">    .. figure:: ../images/ellipse_tangent.png</span>
<span class="sd">       :alt: ellipse tangent</span>
<span class="sd">       :align: center</span>
<span class="sd">       :width: 500px</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    z: list, array like</span>
<span class="sd">        Contains list of tangent points coordinate&#39;s variables ``[x1, y1, x2, y2]``.</span>
<span class="sd">        See :numref:`ellipse tangent`</span>
<span class="sd">    data: list, array like</span>
<span class="sd">        Contains midpoint coordinates of the two ellipses and the dimensions of the ellipses</span>
<span class="sd">        data = ``[coords, dim]``; ``coords`` = ``[h, k, p, q]``, ``dim`` = ``[a, b, A, B]``</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list of four non-linear functions</span>

<span class="sd">    Note</span>
<span class="sd">    -----</span>
<span class="sd">    The four returned non-linear functions are</span>

<span class="sd">    .. math::</span>

<span class="sd">       f_1 = \\frac{A^2b^2(x_1 - h)(y_2-q)}{a^2B^2(x_2-p)(y_1-k)} - 1</span>

<span class="sd">       f_2 = \\frac{(x_1 - h)^2}{a^2} + \\frac{(y_1-k)^2}{b^2} - 1</span>

<span class="sd">       f_3 = \\frac{(x_2 - p)^2}{A^2} + \\frac{(y_2-q)^2}{B^2} - 1</span>

<span class="sd">       f_4 = \\frac{-b^2(x_1-x_2)(x_1-h)}{a^2(y_1-y_2)(y_1-k)} - 1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">coord</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">coord</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">dim</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">z</span>

    <span class="n">f1</span> <span class="o">=</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">f3</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">f4</span> <span class="o">=</span> <span class="o">-</span><span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">f4</span></div>



<div class="viewcode-block" id="jac">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.jac">[docs]</a>
<span class="k">def</span> <span class="nf">jac</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="o">*</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the Jacobian of the non-linear system of ellipse tangent equations</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    z: list, array like</span>
<span class="sd">        Contains list of tangent points coordinate&#39;s variables ``[x1, y1, x2, y2]``.</span>
<span class="sd">        See :numref:`ellipse tangent`</span>
<span class="sd">    data: list, array like</span>
<span class="sd">        Contains midpoint coordinates of the two ellipses and the dimensions of the ellipses</span>
<span class="sd">        data = ``[coords, dim]``; ``coords`` = ``[h, k, p, q]``, ``dim`` = ``[a, b, A, B]``</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    J: array like</span>
<span class="sd">        Array of the Jacobian</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">coord</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">coord</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">dim</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">z</span>

    <span class="c1"># f1 = A ** 2 * b ** 2 * (x1 - h) * (y2 - q) / (a ** 2 * B ** 2 * (x2 - p) * (y1 - k)) - 1</span>
    <span class="c1"># f2 = (x1 - h) ** 2 / a ** 2 + (y1 - k) ** 2 / b ** 2 - 1</span>
    <span class="c1"># f3 = (x2 - p) ** 2 / A ** 2 + (y2 - q) ** 2 / B ** 2 - 1</span>
    <span class="c1"># f4 = -b ** 2 * (x1 - x2) * (x1 - h) / (a ** 2 * (y1 - y2) * (y1 - k)) - 1</span>

    <span class="n">df1_dx1</span> <span class="o">=</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span>
    <span class="n">df1_dy1</span> <span class="o">=</span> <span class="o">-</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">df1_dx2</span> <span class="o">=</span> <span class="o">-</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span>
    <span class="n">df1_dy2</span> <span class="o">=</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span>

    <span class="n">df2_dx1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">df2_dy1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">df2_dx2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df2_dy2</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">df3_dx1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df3_dy1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df3_dx2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">A</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">df3_dy2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="n">B</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="n">df4_dx1</span> <span class="o">=</span> <span class="o">-</span><span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">h</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span>
    <span class="n">df4_dy1</span> <span class="o">=</span> <span class="o">-</span><span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">df4_dx2</span> <span class="o">=</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span>
    <span class="n">df4_dy2</span> <span class="o">=</span> <span class="o">-</span><span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span>

    <span class="n">J</span> <span class="o">=</span> <span class="p">[[</span><span class="n">df1_dx1</span><span class="p">,</span> <span class="n">df1_dy1</span><span class="p">,</span> <span class="n">df1_dx2</span><span class="p">,</span> <span class="n">df1_dy2</span><span class="p">],</span>
         <span class="p">[</span><span class="n">df2_dx1</span><span class="p">,</span> <span class="n">df2_dy1</span><span class="p">,</span> <span class="n">df2_dx2</span><span class="p">,</span> <span class="n">df2_dy2</span><span class="p">],</span>
         <span class="p">[</span><span class="n">df3_dx1</span><span class="p">,</span> <span class="n">df3_dy1</span><span class="p">,</span> <span class="n">df3_dx2</span><span class="p">,</span> <span class="n">df3_dy2</span><span class="p">],</span>
         <span class="p">[</span><span class="n">df4_dx1</span><span class="p">,</span> <span class="n">df4_dy1</span><span class="p">,</span> <span class="n">df4_dx2</span><span class="p">,</span> <span class="n">df4_dy2</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">J</span></div>



<div class="viewcode-block" id="write_cst_paramters">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.write_cst_paramters">[docs]</a>
<span class="k">def</span> <span class="nf">write_cst_paramters</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">ic_</span><span class="p">,</span> <span class="n">oc_l</span><span class="p">,</span> <span class="n">oc_r</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">,</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;slans&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes cavity geometric data that can be imported into CST Studio</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key: str, int</span>
<span class="sd">        Cavity marker</span>
<span class="sd">    ic_: list, array like</span>
<span class="sd">        Inner cavity cell geometric variables</span>
<span class="sd">    oc_l: list, array like</span>
<span class="sd">        Outer cavity cell geometric variables</span>
<span class="sd">    projectDir: str</span>
<span class="sd">        Project directory</span>
<span class="sd">    cell_type: str</span>
<span class="sd">        Single cell or multicell</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ic_</span> <span class="o">=</span> <span class="n">update_alpha</span><span class="p">(</span><span class="n">ic_</span><span class="p">)</span>
    <span class="n">oc_l</span> <span class="o">=</span> <span class="n">update_alpha</span><span class="p">(</span><span class="n">oc_l</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">solver</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ngsolvemevp&#39;</span><span class="p">:</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;NGSolveMEVP&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;Optimisation&#39;</span>

    <span class="k">if</span> <span class="n">cell_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">/SimulationData/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">.txt&#39;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">name_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Aeq&#39;</span><span class="p">,</span> <span class="s1">&#39;Beq&#39;</span><span class="p">,</span> <span class="s1">&#39;ai&#39;</span><span class="p">,</span> <span class="s1">&#39;bi&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;Aeq_e&#39;</span><span class="p">,</span> <span class="s1">&#39;Beq_e&#39;</span><span class="p">,</span> <span class="s1">&#39;ai_e&#39;</span><span class="p">,</span> <span class="s1">&#39;bi_e&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri_e&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;L_e&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_e&#39;</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">]</span>

            <span class="n">value_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ic_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
                          <span class="n">oc_l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">key</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name_list</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">name_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> = &quot;</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">&quot; &quot;</span><span class="si">{</span><span class="n">value_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> = &quot;</span><span class="si">{</span><span class="n">value_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot; &quot;&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">/SimulationData/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">.txt&#39;</span>
        <span class="n">path_mc</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">/SimulationData/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_Multicell.txt&#39;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">name_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Aeq&#39;</span><span class="p">,</span> <span class="s1">&#39;Beq&#39;</span><span class="p">,</span> <span class="s1">&#39;ai&#39;</span><span class="p">,</span> <span class="s1">&#39;bi&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">,</span> <span class="s1">&#39;Aeq_e&#39;</span><span class="p">,</span> <span class="s1">&#39;Beq_e&#39;</span><span class="p">,</span> <span class="s1">&#39;ai_e&#39;</span><span class="p">,</span> <span class="s1">&#39;bi_e&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri_e&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;L_e&#39;</span><span class="p">,</span> <span class="s1">&#39;Req_e&#39;</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">]</span>  <span class="c1"># &#39;alpha_e&#39;, &#39;key&#39;]</span>

            <span class="k">if</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="s1">&#39;Mid Cell&#39;</span><span class="p">:</span>
                <span class="n">value_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ic_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>  <span class="c1">#ic_[7],</span>
                              <span class="s1">&#39;Aeq&#39;</span><span class="p">,</span> <span class="s1">&#39;Beq&#39;</span><span class="p">,</span> <span class="s1">&#39;ai&#39;</span><span class="p">,</span> <span class="s1">&#39;bi&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">]</span>  <span class="c1">#&#39;alpha&#39;, key]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ic_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>  <span class="c1">#ic_[7],</span>
                              <span class="n">oc_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oc_r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">oc_r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">oc_r</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">oc_r</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">oc_r</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>  <span class="c1">#oc_l[7],</span>
                              <span class="n">oc_l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>  <span class="c1">#oc_l[7],</span>
                              <span class="n">key</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name_list</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">name_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> = &quot;</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">&quot; &quot;</span><span class="si">{</span><span class="n">value_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> = &quot;</span><span class="si">{</span><span class="n">value_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot; &quot;&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_mc</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">name_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Aeq&#39;</span><span class="p">,</span> <span class="s1">&#39;Beq&#39;</span><span class="p">,</span> <span class="s1">&#39;ai&#39;</span><span class="p">,</span> <span class="s1">&#39;bi&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">,</span>  <span class="c1">#&#39;alpha&#39;,</span>
                         <span class="s1">&#39;Aeq_er&#39;</span><span class="p">,</span> <span class="s1">&#39;Beq_er&#39;</span><span class="p">,</span> <span class="s1">&#39;ai_er&#39;</span><span class="p">,</span> <span class="s1">&#39;bi_er&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri_er&#39;</span><span class="p">,</span> <span class="s1">&#39;L_er&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">,</span>  <span class="c1">#&#39;alpha_er&#39;,</span>
                         <span class="s1">&#39;Aeq_el&#39;</span><span class="p">,</span> <span class="s1">&#39;Beq_el&#39;</span><span class="p">,</span> <span class="s1">&#39;ai_el&#39;</span><span class="p">,</span> <span class="s1">&#39;bi_el&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri_el&#39;</span><span class="p">,</span> <span class="s1">&#39;L_el&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">]</span>  <span class="c1">#&#39;alpha_el&#39;, &#39;key&#39;]</span>

            <span class="k">if</span> <span class="n">cell_type</span> <span class="o">==</span> <span class="s1">&#39;Mid Cell&#39;</span><span class="p">:</span>
                <span class="n">value_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ic_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>  <span class="c1">#ic_[7],</span>
                              <span class="s1">&#39;Aeq&#39;</span><span class="p">,</span> <span class="s1">&#39;Beq&#39;</span><span class="p">,</span> <span class="s1">&#39;ai&#39;</span><span class="p">,</span> <span class="s1">&#39;bi&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">,</span>  <span class="c1">#&#39;alpha&#39;,</span>
                              <span class="s1">&#39;Aeq&#39;</span><span class="p">,</span> <span class="s1">&#39;Beq&#39;</span><span class="p">,</span> <span class="s1">&#39;ai&#39;</span><span class="p">,</span> <span class="s1">&#39;bi&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">,</span>  <span class="c1">#&#39;alpha&#39;,</span>
                              <span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ic_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>  <span class="c1">#ic_[7],</span>
                              <span class="n">oc_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oc_r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">oc_r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">oc_r</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">oc_r</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">oc_r</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>  <span class="c1">#oc_r[7],</span>
                              <span class="n">oc_l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">oc_l</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">ic_</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>  <span class="c1">#oc_l[7],</span>
                              <span class="n">key</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name_list</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">name_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> = &quot;</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">&quot; &quot;</span><span class="si">{</span><span class="n">value_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> = &quot;</span><span class="si">{</span><span class="n">value_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot; &quot;&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="stroud">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.stroud">[docs]</a>
<span class="k">def</span> <span class="nf">stroud</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stroud-3 method</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p: int</span>
<span class="sd">        Dimension</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Nodes of quadrature rule in [0,1]**p (column-wise)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Stroud-3 method</span>
    <span class="c1">#</span>
    <span class="c1"># Input parameters:</span>
    <span class="c1">#  p   number of dimensions</span>
    <span class="c1"># Output parameters:</span>
    <span class="c1">#  nodes   nodes of quadrature rule in [0,1]**p (column-wise)</span>
    <span class="c1">#</span>

    <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">))</span>
    <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">p</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">p</span><span class="p">))):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">r</span>
            <span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">coeff</span><span class="p">)</span>
            <span class="n">nodes</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">coeff</span><span class="p">)</span>

        <span class="k">if</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">p</span><span class="p">):</span>
            <span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># transform nodes from [-1,+1]**p to [0,1]**p</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">nodes</span> <span class="o">+</span> <span class="mf">0.5</span>

    <span class="k">return</span> <span class="n">nodes</span></div>



<div class="viewcode-block" id="quad_stroud3">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.quad_stroud3">[docs]</a>
<span class="k">def</span> <span class="nf">quad_stroud3</span><span class="p">(</span><span class="n">rdim</span><span class="p">,</span> <span class="n">degree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stroud-3 quadrature in :math:`[0,1]^k`</span>

<span class="sd">    .. note::</span>

<span class="sd">        Dimensional Threshold Limitation: In practice, the Stroud 3 quadrature rule may be effective in dimensions</span>
<span class="sd">        up to around 3 to 6, depending on the specific problem and the function being integrated. Beyond this,</span>
<span class="sd">        the accuracy of the rule typically degrades, and higher-order quadrature rules or</span>
<span class="sd">        Monte Carlo methods might be more appropriate.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rdim: int</span>
<span class="sd">        Dimension of variables</span>
<span class="sd">    degree: int</span>
<span class="sd">        Degree</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Nodes and corresponding weights</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># data for Stroud-3 quadrature in [0,1]**k</span>
    <span class="c1"># nodes and weights</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">stroud</span><span class="p">(</span><span class="n">rdim</span><span class="p">)</span>
    <span class="n">nodestr</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">nodes</span> <span class="o">-</span> <span class="mf">1.</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rdim</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rdim</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># evaluation of Legendre polynomials</span>
    <span class="n">bpoly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rdim</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rdim</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rdim</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rdim</span><span class="p">):</span>
            <span class="n">bpoly</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ll</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">bpoly</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ll</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodestr</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">degree</span><span class="p">):</span>
                <span class="n">bpoly</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ll</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nodestr</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">bpoly</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ll</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">bpoly</span><span class="p">[</span>
                    <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ll</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># standardisation of Legendre polynomials</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">bpoly</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">bpoly</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bpoly</span></div>



<div class="viewcode-block" id="c1_leg_monomial_integral">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.c1_leg_monomial_integral">[docs]</a>
<span class="k">def</span> <span class="nf">c1_leg_monomial_integral</span><span class="p">(</span><span class="n">expon</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">expon</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="p">(</span><span class="s2">&quot;C1_LEG_MONOMIAL_INTEGRAL - Fatal error!&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="p">(</span><span class="s2">&quot;EXPON &lt; 0.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;C1_LEG_MONOMIAL_INTEGRAL - Fatal error!&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">expon</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">value</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">expon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span></div>



<div class="viewcode-block" id="cn_leg_03_xiu">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.cn_leg_03_xiu">[docs]</a>
<span class="k">def</span> <span class="nf">cn_leg_03_xiu</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">o</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

    <span class="n">expon</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="n">c1_leg_monomial_integral</span><span class="p">(</span><span class="n">expon</span><span class="p">)</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span> <span class="o">**</span> <span class="n">n</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">o</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">j</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume</span> <span class="o">/</span> <span class="n">o</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span></div>



<div class="viewcode-block" id="cn_leg_03_1">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.cn_leg_03_1">[docs]</a>
<span class="k">def</span> <span class="nf">cn_leg_03_1</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">o</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span>

    <span class="n">expon</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="n">c1_leg_monomial_integral</span><span class="p">(</span><span class="n">expon</span><span class="p">)</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span> <span class="o">**</span> <span class="n">n</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">o</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r8_mop</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">r8_mop</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>

    <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume</span> <span class="o">/</span> <span class="n">o</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span></div>



<div class="viewcode-block" id="r8_mop">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.r8_mop">[docs]</a>
<span class="k">def</span> <span class="nf">r8_mop</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="k">return</span> <span class="n">value</span></div>



<div class="viewcode-block" id="cn_leg_05_1">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.cn_leg_05_1">[docs]</a>
<span class="k">def</span> <span class="nf">cn_leg_05_1</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The rule has order</span>

<span class="sd">    O = 2 N^2 + N + 2.</span>

<span class="sd">    The rule has precision P = 5.</span>

<span class="sd">    CN_LEG is the cube [-1,+1]^N with the Legendre weight function</span>

<span class="sd">    w(x) = 1.</span>

<span class="sd">    .. note::</span>

<span class="sd">        Dimensional Threshold Limitation: In practice, the Stroud 3 quadrature rule may be effective in dimensions</span>
<span class="sd">        up to around 3 to 6, depending on the specific problem and the function being integrated. Beyond this,</span>
<span class="sd">        the accuracy of the rule typically degrades, and higher-order quadrature rules or</span>
<span class="sd">        Monte Carlo methods might be more appropriate.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n</span>
<span class="sd">    option</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if the value of n is 4, 5, or 6</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
        <span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="p">(</span><span class="s2">&quot;CN_LEG_05_1 - Fatal error!&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="p">(</span><span class="s2">&quot;The value of N must be 4, 5, or 6.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CN_LEG_05_1 - Fatal error!&quot;</span><span class="p">)</span>

    <span class="c1"># Check for valid option when n = 4 or 5</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
        <span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="p">(</span><span class="s2">&quot;CN_LEG_05_1 - Fatal error!&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="p">(</span><span class="s2">&quot;When N = 4 or 5, OPTION must be 1 or 2.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CN_LEG_05_1 - Fatal error!&quot;</span><span class="p">)</span>

    <span class="n">o</span> <span class="o">=</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span>

    <span class="n">expon</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="n">c1_leg_monomial_integral</span><span class="p">(</span><span class="n">expon</span><span class="p">)</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span> <span class="o">**</span> <span class="n">n</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="mf">0.778984505799815</span>
        <span class="n">lmbda</span> <span class="o">=</span> <span class="mf">1.284565137874656</span>
        <span class="n">xsi</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.713647298819253</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.715669761974162</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.217089151000943</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.206186096875899e-01</span> <span class="o">*</span> <span class="n">volume</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mf">0.975705820221664e-02</span> <span class="o">*</span> <span class="n">volume</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mf">0.733921929172573e-01</span> <span class="o">*</span> <span class="n">volume</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="mf">0.546190755827425E+00</span>
        <span class="n">lmbda</span> <span class="o">=</span> <span class="mf">0.745069130115661E+00</span>
        <span class="n">xsi</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.413927294508700E+00</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.343989637454535E+00</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.134017894600344E+00</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.853094758323323E-01</span> <span class="o">*</span> <span class="n">volume</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mf">0.862099000096395E-01</span> <span class="o">*</span> <span class="n">volume</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mf">0.116418206881849E-01</span> <span class="o">*</span> <span class="n">volume</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="mf">0.522478547481276E+00</span>
        <span class="n">lmbda</span> <span class="o">=</span> <span class="mf">0.936135175985774E+00</span>
        <span class="n">xsi</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.246351362101519E+00</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.496308106093758E+00</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.827180176822930E+00</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.631976901960153E-01</span> <span class="o">*</span> <span class="n">volume</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mf">0.511464127430166E-01</span> <span class="o">*</span> <span class="n">volume</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mf">0.181070246088902E-01</span> <span class="o">*</span> <span class="n">volume</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="mf">0.798317301388741E+00</span>
        <span class="n">lmbda</span> <span class="o">=</span> <span class="mf">0.637344273885728E+00</span>
        <span class="n">xsi</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.455245909918377E+00</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">1.063446229997311E+00</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.354482076665770E+00</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.116952384292206E-01</span> <span class="o">*</span> <span class="n">volume</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mf">0.701731258612708E-01</span> <span class="o">*</span> <span class="n">volume</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mf">0.137439132264426E-01</span> <span class="o">*</span> <span class="n">volume</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="mf">0.660225291773525E+00</span>
        <span class="n">lmbda</span> <span class="o">=</span> <span class="mf">1.064581294844754E+00</span>
        <span class="n">xsi</span> <span class="o">=</span> <span class="mf">0.000000000000000E+00</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.660225291773525E+00</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.660225291773525E+00</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.182742214532872E-01</span> <span class="o">*</span> <span class="n">volume</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mf">0.346020761245675E-01</span> <span class="o">*</span> <span class="n">volume</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mf">0.182742214532872E-01</span> <span class="o">*</span> <span class="n">volume</span>

    <span class="c1"># Set x and w based on parameters</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># k += 1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">eta</span>
    <span class="n">w</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>

    <span class="c1"># k += 1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">eta</span>
    <span class="n">w</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>

    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">xsi</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">lmbda</span>
        <span class="n">w</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">xsi</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">lmbda</span>
        <span class="n">w</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span>
            <span class="n">w</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">gamma</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">mu</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">mu</span>
            <span class="n">w</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span></div>



<div class="viewcode-block" id="cn_leg_05_2">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.cn_leg_05_2">[docs]</a>
<span class="k">def</span> <span class="nf">cn_leg_05_2</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The rule has order</span>

<span class="sd">    O = 2 N^2 + 1.</span>

<span class="sd">    The rule has precision P = 5.</span>

<span class="sd">    CN_LEG is the cube [-1,+1]^N with the Legendre weight function</span>

<span class="sd">    w(x) = 1.</span>

<span class="sd">    .. note::</span>

<span class="sd">        Dimensional Threshold Limitation: In practice, the Stroud 5 quadrature rule may be effective in dimensions</span>
<span class="sd">        up to around 5 to 10, depending on the specific problem and the function being integrated. Beyond this,</span>
<span class="sd">        the accuracy of the rule typically degrades, and higher-order quadrature rules or</span>
<span class="sd">        Monte Carlo methods might be more appropriate.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n</span>
<span class="sd">    option</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">error</span><span class="p">(</span><span class="s2">&quot;CN_LEG_05_2 - Fatal error!&quot;</span><span class="p">)</span>
        <span class="n">error</span><span class="p">(</span><span class="s2">&quot;N must be at least 2.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CN_LEG_05_2 - Fatal error!&quot;</span><span class="p">)</span>

    <span class="n">o</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">o</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="n">expon</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="n">c1_leg_monomial_integral</span><span class="p">(</span><span class="n">expon</span><span class="p">)</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span> <span class="o">**</span> <span class="n">n</span>

    <span class="n">b0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">25</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">115</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">162</span><span class="p">)</span> <span class="o">*</span> <span class="n">volume</span> <span class="o">/</span> <span class="mf">162.0</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">70</span> <span class="o">-</span> <span class="mi">25</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">volume</span> <span class="o">/</span> <span class="mf">162.0</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="mf">25.0</span> <span class="o">*</span> <span class="n">volume</span> <span class="o">/</span> <span class="mf">324.0</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">)</span>

    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">w</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b0</span>

    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="n">r</span>
        <span class="n">w</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b1</span>

        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">r</span>
        <span class="n">w</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b1</span>

    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="n">r</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="n">r</span>
            <span class="n">w</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b2</span>

            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="n">r</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">r</span>
            <span class="n">w</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b2</span>

            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">r</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="n">r</span>
            <span class="n">w</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b2</span>

            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">r</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">r</span>
            <span class="n">w</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b2</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span></div>



<div class="viewcode-block" id="cn_gauss">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.cn_gauss">[docs]</a>
<span class="k">def</span> <span class="nf">cn_gauss</span><span class="p">(</span><span class="n">rdim</span><span class="p">,</span> <span class="n">degree</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">legendre</span><span class="o">.</span><span class="n">leggauss</span><span class="p">(</span><span class="n">degree</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rdim</span><span class="p">)]</span>

    <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">rdim</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">degree</span> <span class="o">**</span> <span class="n">rdim</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">degree</span> <span class="o">**</span> <span class="n">rdim</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span></div>



<div class="viewcode-block" id="weighted_mean_obj">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.weighted_mean_obj">[docs]</a>
<span class="k">def</span> <span class="nf">weighted_mean_obj</span><span class="p">(</span><span class="n">tab_var</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
    <span class="n">rows_sims_no</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">tab_var</span><span class="p">)</span>
    <span class="n">no_weights</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rows_sims_no</span> <span class="o">==</span> <span class="n">no_weights</span><span class="p">:</span>
        <span class="n">expe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">cols</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">outvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">cols</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="n">expe</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">tab_var</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">weights</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">outvar</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">tab_var</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">weights</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">stdDev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">outvar</span> <span class="o">-</span> <span class="n">expe</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">expe</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stdDev</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Cols_sims_no != No_weights&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">expe</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="n">stdDev</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>



<div class="viewcode-block" id="normal_dist">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.normal_dist">[docs]</a>
<span class="k">def</span> <span class="nf">normal_dist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span><span class="p">):</span>
    <span class="n">prob_density</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sd</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">sd</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prob_density</span></div>



<div class="viewcode-block" id="linspace">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.linspace">[docs]</a>
<span class="k">def</span> <span class="nf">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Like np.linspace but uses step instead of num</span>
<span class="sd">    This is inclusive to stop, so if start=1, stop=3, step=0.5</span>
<span class="sd">    Output is: array([1., 1.5, 2., 2.5, 3.])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ll</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">stop</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">start</span> <span class="o">-</span> <span class="n">stop</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ll</span></div>



<div class="viewcode-block" id="lineTo">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.lineTo">[docs]</a>
<span class="k">def</span> <span class="nf">lineTo</span><span class="p">(</span><span class="n">prevPt</span><span class="p">,</span> <span class="n">nextPt</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
        <span class="c1"># vertical line</span>
        <span class="k">if</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">py</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">py</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">py</span> <span class="o">=</span> <span class="n">py</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">py</span><span class="p">))</span> <span class="o">*</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
        <span class="c1"># horizontal line</span>
        <span class="k">if</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>

        <span class="n">py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">px</span><span class="p">))</span> <span class="o">*</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># calculate angle to get appropriate step size for x and y</span>
        <span class="n">ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
            <span class="n">py</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">px</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">py</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
            <span class="n">py</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
            <span class="n">py</span> <span class="o">=</span> <span class="n">py</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">px</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">py</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
            <span class="n">py</span> <span class="o">=</span> <span class="n">py</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">)</span>  <span class="c1">#, marker=&#39;x&#39;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">])</span><span class="o">.</span><span class="n">T</span></div>



<div class="viewcode-block" id="arcTo">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.arcTo">[docs]</a>
<span class="k">def</span> <span class="nf">arcTo</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h: float, int</span>
<span class="sd">        x-position of the center</span>
<span class="sd">    k: float, int</span>
<span class="sd">        y-position of the center</span>
<span class="sd">    a float, int</span>
<span class="sd">        radius on the x-axis</span>
<span class="sd">    b float, int</span>
<span class="sd">        radius on the y-axis</span>
<span class="sd">    step: int</span>
<span class="sd">    start: list, ndarray</span>
<span class="sd">    end: list, ndarray</span>
<span class="sd">    plot: bool</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>  <span class="c1"># &lt;- approximate perimeter of ellipse</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">start</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">end</span>
    <span class="c1"># calculate parameter start and end points</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">((</span><span class="n">y1</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="p">),</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">((</span><span class="n">y2</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="p">),</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="n">direction</span><span class="p">,</span> <span class="n">shortest_distance</span> <span class="o">=</span> <span class="n">shortest_direction</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;clockwise&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">t2</span> <span class="o">&gt;</span> <span class="n">t1</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">C</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">t1</span> <span class="o">&gt;</span> <span class="n">t2</span><span class="p">:</span>
            <span class="n">t2</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">C</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)))</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1">#, marker=&#39;x&#39;</span>

    <span class="k">return</span> <span class="n">pts</span></div>



<div class="viewcode-block" id="arcToTheta">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.arcToTheta">[docs]</a>
<span class="k">def</span> <span class="nf">arcToTheta</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the points on an arc from a start angle to an end angle</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h: float, int</span>
<span class="sd">        x-position of the center</span>
<span class="sd">    k: float, int</span>
<span class="sd">        y-position of the center</span>
<span class="sd">    a float, int</span>
<span class="sd">        radius on the x-axis</span>
<span class="sd">    b float, int</span>
<span class="sd">        radius on the y-axis</span>
<span class="sd">    step: int, float</span>
<span class="sd">    start: list, ndarray</span>
<span class="sd">    end: list, ndarray</span>
<span class="sd">    plot: bool</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>  <span class="c1"># &lt;- approximate perimeter of ellipse</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">start</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">end</span>

    <span class="c1"># plot center point</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">direction</span><span class="p">,</span> <span class="n">shortest_distance</span> <span class="o">=</span> <span class="n">shortest_direction</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;clockwise&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">t2</span> <span class="o">&gt;</span> <span class="n">t1</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">C</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">t1</span> <span class="o">&gt;</span> <span class="n">t2</span><span class="p">:</span>
            <span class="n">t2</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">C</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)))</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1">#, marker=&#39;x&#39;</span>

    <span class="k">return</span> <span class="n">pts</span></div>



<div class="viewcode-block" id="shortest_direction">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.shortest_direction">[docs]</a>
<span class="k">def</span> <span class="nf">shortest_direction</span><span class="p">(</span><span class="n">start_angle</span><span class="p">,</span> <span class="n">end_angle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    start_angle: float, int</span>
<span class="sd">        Start angle in radians</span>
<span class="sd">    end_angle: float, int</span>
<span class="sd">        End angle in radians</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure the angles are in the range [0, 2*pi]</span>
    <span class="n">start_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">start_angle</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">end_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">end_angle</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="c1"># Calculate the direct difference</span>
    <span class="n">delta_theta</span> <span class="o">=</span> <span class="n">end_angle</span> <span class="o">-</span> <span class="n">start_angle</span>

    <span class="c1"># Normalize the difference to be within [-pi, pi]</span>
    <span class="k">if</span> <span class="n">delta_theta</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
        <span class="n">delta_theta</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">elif</span> <span class="n">delta_theta</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
        <span class="n">delta_theta</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="c1"># Determine the direction</span>
    <span class="k">if</span> <span class="n">delta_theta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;anticlockwise&quot;</span><span class="p">,</span> <span class="n">delta_theta</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;clockwise&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">delta_theta</span></div>



<div class="viewcode-block" id="write_cavity_geometry_cli">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.write_cavity_geometry_cli">[docs]</a>
<span class="k">def</span> <span class="nf">write_cavity_geometry_cli</span><span class="p">(</span><span class="n">IC</span><span class="p">,</span> <span class="n">OC</span><span class="p">,</span> <span class="n">OC_R</span><span class="p">,</span> <span class="n">BP</span><span class="p">,</span> <span class="n">n_cell</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tangent_check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">ignore_degenerate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">contour</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot cavity geometry</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tangent_check</span>
<span class="sd">    bc</span>
<span class="sd">    ax</span>
<span class="sd">    ignore_degenerate</span>
<span class="sd">    IC: list, ndarray</span>
<span class="sd">        Inner Cell geometric parameters list</span>
<span class="sd">    OC: list, ndarray</span>
<span class="sd">        Left outer Cell geometric parameters list</span>
<span class="sd">    OC_R: list, ndarray</span>
<span class="sd">        Right outer Cell geometric parameters list</span>
<span class="sd">    BP: str {&quot;left&quot;, &quot;right&quot;, &quot;both&quot;, &quot;none&quot;}</span>
<span class="sd">        Specify if beam pipe is on one or both ends or at no end at all</span>
<span class="sd">    n_cell: int</span>
<span class="sd">        Number of cavity cells</span>
<span class="sd">    scale: float</span>
<span class="sd">        Scale of the cavity geometry</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">IC</span><span class="p">)[:</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">*</span> <span class="mf">1e-3</span>
    <span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">,</span> <span class="n">L_el</span><span class="p">,</span> <span class="n">Req</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">OC</span><span class="p">)[:</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">*</span> <span class="mf">1e-3</span>
    <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="n">L_er</span><span class="p">,</span> <span class="n">Req</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">OC_R</span><span class="p">)[:</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">*</span> <span class="mf">1e-3</span>

    <span class="n">L_bp</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">L_m</span>
    <span class="k">if</span> <span class="n">dimension</span> <span class="ow">or</span> <span class="n">contour</span><span class="p">:</span>
        <span class="n">L_bp</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">L_m</span>

    <span class="k">if</span> <span class="n">BP</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="n">L_bp</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="n">L_bp</span>
    <span class="k">elif</span> <span class="n">BP</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="n">L_bp</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>
    <span class="k">elif</span> <span class="n">BP</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="n">L_bp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>

    <span class="n">step</span> <span class="o">=</span> <span class="mf">0.005</span>

    <span class="c1"># calculate shift</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># calculate angles outside loop</span>
    <span class="c1"># CALCULATE x1_el, y1_el, x2_el, y2_el</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">,</span> <span class="n">L_el</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">tangent_check</span><span class="o">=</span><span class="n">tangent_check</span><span class="p">)</span>
    <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">,</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_degenerate</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Parameter set leads to degenerate geometry.&#39;</span><span class="p">)</span>
            <span class="c1"># save figure of error</span>
            <span class="k">return</span>

    <span class="c1"># CALCULATE x1, y1, x2, y2</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">tangent_check</span><span class="o">=</span><span class="n">tangent_check</span><span class="p">)</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_degenerate</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Parameter set leads to degenerate geometry.&#39;</span><span class="p">)</span>
            <span class="c1"># save figure of error</span>
            <span class="k">return</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="n">L_er</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="n">tangent_check</span><span class="o">=</span><span class="n">tangent_check</span><span class="p">)</span>
    <span class="n">x1er</span><span class="p">,</span> <span class="n">y1er</span><span class="p">,</span> <span class="n">x2er</span><span class="p">,</span> <span class="n">y2er</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_degenerate</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Parameter set leads to degenerate geometry.&#39;</span><span class="p">)</span>
            <span class="c1"># save figure of error</span>
            <span class="k">return</span>

    <span class="n">geo</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># SHIFT POINT TO START POINT</span>
    <span class="n">start_point</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="n">lineTo</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="k">if</span> <span class="n">bc</span><span class="p">:</span>
        <span class="c1"># draw left boundary condition</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="o">-</span><span class="n">shift</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">Ri_el</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">-</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">,</span> <span class="o">-</span><span class="n">shift</span> <span class="o">-</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ri_el</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ri_el</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">-</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">,</span> <span class="o">-</span><span class="n">shift</span> <span class="o">-</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">Ri_el</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">Ri_el</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1"># ADD BEAM PIPE LENGTH</span>
    <span class="k">if</span> <span class="n">L_bp_l</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">]</span>

        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cell</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># DRAW ARC:</span>
            <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">dimension</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">ellipse</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a_el</span><span class="p">,</span>
                                                         <span class="n">height</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                                         <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="o">+</span><span class="n">a_el</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">),</span>
                            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">),</span>
                            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">),</span>
                            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">),</span>
                            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">a_el</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">a_el</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="p">(</span><span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">b_el</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># DRAW LINE CONNECTING ARCS</span>
            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span><span class="p">]</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">dimension</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">ellipse</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">A_el</span><span class="p">,</span>
                                                         <span class="n">height</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                                         <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">),</span>
                            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">A_el</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">),</span>
                            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">),</span>
                            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">),</span>
                            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">A_el</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">A_el</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="p">(</span><span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">B_el</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

            <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="k">if</span> <span class="n">n_cell</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">L_bp_r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

                    <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">dimension</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                        <span class="n">ellipse</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">A_er</span><span class="p">,</span>
                                                                 <span class="n">height</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                                                 <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">),</span>
                                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">),</span>
                                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">),</span>
                                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">),</span>
                                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>

                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">A_er</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">A_er</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="p">(</span><span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">B_er</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

                    <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">]</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

                    <span class="c1"># ARC</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">dimension</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                        <span class="n">ellipse</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a_er</span><span class="p">,</span>
                                                                 <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">b_er</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                                                 <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span>
                                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span>
                                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">),</span>
                                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span>
                                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>

                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">a_er</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">a_er</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="p">(</span><span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">b_er</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

                    <span class="c1"># calculate new shift</span>
                    <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

                    <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">]</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

                    <span class="c1"># ARC</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">dimension</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                        <span class="n">ellipse</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a_er</span><span class="p">,</span>
                                                                 <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">b_er</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                                                 <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span>
                                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span>
                                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">),</span>
                                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span>
                                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>

                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">a_er</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">a_er</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="p">(</span><span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">b_er</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                <span class="c1"># half of bounding box is required,</span>
                <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                            <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">])</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

                <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

                <span class="c1"># ARC</span>
                <span class="c1"># half of bounding box is required,</span>
                <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                            <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">])</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

                <span class="c1"># calculate new shift</span>
                <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span><span class="p">)</span>
                <span class="c1"># ic(shift)</span>

        <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">n_cell</span><span class="p">:</span>
            <span class="c1"># DRAW ARC:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># DRAW LINE CONNECTING ARCS</span>
            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
            <span class="c1"># half of bounding box is required,</span>
            <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># ARC</span>
            <span class="c1"># half of bounding box is required,</span>
            <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># calculate new shift</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># DRAW ARC:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># DRAW LINE CONNECTING ARCS</span>
            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
            <span class="c1"># half of bounding box is required,</span>
            <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">]</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># ARC</span>
            <span class="c1"># half of bounding box is required,</span>
            <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="c1"># BEAM PIPE</span>
    <span class="c1"># reset shift</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">L_bp_r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if there&#39;s a problem, check here.</span>
        <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="c1"># END PATH</span>
    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>  <span class="c1"># to add beam pipe to right</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="c1"># lineTo(pt, [2 * n_cell * L_er + L_bp_l - shift, 0], step)</span>
    <span class="c1"># pt = [2 * n_cell * L_er + L_bp_l - shift, 0]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="c1"># write geometry</span>
    <span class="k">if</span> <span class="n">write</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">])</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">write</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Check file path:: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="c1"># append start point</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="k">if</span> <span class="n">bc</span><span class="p">:</span>
        <span class="c1"># draw right boundary condition</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">shift</span><span class="p">,</span> <span class="n">shift</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">Ri_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">],</span>
                <span class="p">[</span><span class="n">shift</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">shift</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ri_er</span><span class="p">],</span>
                <span class="p">[</span><span class="n">shift</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">shift</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">Ri_er</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1"># CLOSE PATH</span>
    <span class="c1"># lineTo(pt, start_point, step)</span>
    <span class="c1"># geo.append([start_point[1], start_point[0]])</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dimension</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">geo</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">geo</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># recenter asymmetric cavity to center</span>
            <span class="n">shift_left</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">n_cell</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">shift_to_center</span> <span class="o">=</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_r</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shift_to_center</span> <span class="o">=</span> <span class="n">n_cell</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_r</span>

            <span class="n">top</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">geo</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift_left</span> <span class="o">+</span> <span class="n">shift_to_center</span><span class="p">,</span> <span class="n">geo</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># bottom = ax.plot(geo[:, 1] - shift_left + shift_to_center, -geo[:, 0], c=top[0].get_color(), **kwargs)</span>

        <span class="c1"># plot legend wthout duplicates</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">by_label</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">handles</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">by_label</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">by_label</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="write_cavity_geometry_cli_flattop">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.write_cavity_geometry_cli_flattop">[docs]</a>
<span class="k">def</span> <span class="nf">write_cavity_geometry_cli_flattop</span><span class="p">(</span><span class="n">IC</span><span class="p">,</span> <span class="n">OC</span><span class="p">,</span> <span class="n">OC_R</span><span class="p">,</span> <span class="n">BP</span><span class="p">,</span> <span class="n">n_cell</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tangent_check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="n">ignore_degenerate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="n">contour</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write cavity geometry</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    BP</span>
<span class="sd">    OC_R</span>
<span class="sd">    OC</span>
<span class="sd">    ignore_degenerate</span>
<span class="sd">    file_path: str</span>
<span class="sd">        File path to write geometry to</span>
<span class="sd">    n_cell: int</span>
<span class="sd">        Number of cavity cells</span>
<span class="sd">    mid_cell: list, ndarray</span>
<span class="sd">        Array of cavity middle cells&#39; geometric parameters</span>
<span class="sd">    end_cell_left: list, ndarray</span>
<span class="sd">        Array of cavity left end cell&#39;s geometric parameters</span>
<span class="sd">    end_cell_right: list, ndarray</span>
<span class="sd">        Array of cavity left end cell&#39;s geometric parameters</span>
<span class="sd">    beampipe: str {&quot;left&quot;, &quot;right&quot;, &quot;both&quot;, &quot;none&quot;}</span>
<span class="sd">        Specify if beam pipe is on one or both ends or at no end at all</span>
<span class="sd">    plot: bool</span>
<span class="sd">        If True, the cavity geometry is plotted for viewing</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">OC</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">end_cell_left</span> <span class="o">=</span> <span class="n">IC</span>

    <span class="k">if</span> <span class="n">OC_R</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">OC</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">OC_R</span> <span class="o">=</span> <span class="n">IC</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">OC_R</span> <span class="o">=</span> <span class="n">OC</span>

    <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">lft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">IC</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">*</span> <span class="mf">1e-3</span>
    <span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">,</span> <span class="n">L_el</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">lft_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">OC</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">*</span> <span class="mf">1e-3</span>
    <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="n">L_er</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">lft_er</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">OC_R</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">*</span> <span class="mf">1e-3</span>

    <span class="n">step</span> <span class="o">=</span> <span class="mf">0.005</span>

    <span class="n">L_bp</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">L_m</span>
    <span class="k">if</span> <span class="n">dimension</span> <span class="ow">or</span> <span class="n">contour</span><span class="p">:</span>
        <span class="n">L_bp</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">L_m</span>

    <span class="k">if</span> <span class="n">BP</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="n">L_bp</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="n">L_bp</span>
    <span class="k">elif</span> <span class="n">BP</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="n">L_bp</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>
    <span class="k">elif</span> <span class="n">BP</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="n">L_bp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>

    <span class="c1"># calculate shift</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">lft</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">lft_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># calculate angles outside loop</span>
    <span class="c1"># CALCULATE x1_el, y1_el, x2_el, y2_el</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">,</span> <span class="n">L_el</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">lft_el</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">tangent_check</span><span class="o">=</span><span class="n">tangent_check</span><span class="p">)</span>
    <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">,</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_degenerate</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Parameter set leads to degenerate geometry.&#39;</span><span class="p">)</span>
            <span class="c1"># save figure of error</span>
            <span class="k">return</span>

    <span class="c1"># CALCULATE x1, y1, x2, y2</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">lft</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">tangent_check</span><span class="o">=</span><span class="n">tangent_check</span><span class="p">)</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_degenerate</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Parameter set leads to degenerate geometry.&#39;</span><span class="p">)</span>
            <span class="c1"># save figure of error</span>
            <span class="k">return</span>

    <span class="c1"># CALCULATE x1_er, y1_er, x2_er, y2_er</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="n">L_er</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="n">lft_er</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">tangent_check</span><span class="o">=</span><span class="n">tangent_check</span><span class="p">)</span>
    <span class="n">x1er</span><span class="p">,</span> <span class="n">y1er</span><span class="p">,</span> <span class="n">x2er</span><span class="p">,</span> <span class="n">y2er</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_degenerate</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Parameter set leads to degenerate geometry.&#39;</span><span class="p">)</span>
            <span class="c1"># save figure of error</span>
            <span class="k">return</span>

    <span class="n">geo</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># SHIFT POINT TO START POINT</span>
    <span class="n">start_point</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">])</span>

    <span class="n">lineTo</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># ADD BEAM PIPE LENGTH</span>
    <span class="k">if</span> <span class="n">L_bp_l</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">]</span>

        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cell</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># DRAW ARC:</span>
            <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">dimension</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">ellipse</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a_el</span><span class="p">,</span>
                                                         <span class="n">height</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                                         <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="o">+</span><span class="n">a_el</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">),</span>
                            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">),</span>
                            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">),</span>
                            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">),</span>
                            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">a_el</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">a_el</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="p">(</span><span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">b_el</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># DRAW LINE CONNECTING ARCS</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">dimension</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">ellipse</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">A_el</span><span class="p">,</span>
                                                         <span class="n">height</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                                         <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">),</span>
                            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">A_el</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">),</span>
                            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">),</span>
                            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">),</span>
                            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">A_el</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">A_el</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="p">(</span><span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">B_el</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

            <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># flat top</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">dimension</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                <span class="c1"># Plot the straight line</span>
                <span class="n">line_start</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
                <span class="n">line_end</span> <span class="o">=</span> <span class="n">pt</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">line_start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">line_end</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">line_start</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line_end</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">line_start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">line_start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">line_end</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">line_end</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span>
                            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">line_start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_end</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">line_start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">lft_el</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">n_cell</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">L_bp_r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">dimension</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                        <span class="n">ellipse</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">A_er</span><span class="p">,</span>
                                                                 <span class="n">height</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                                                 <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">),</span>
                                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">),</span>
                                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">),</span>
                                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">),</span>
                                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>

                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">A_er</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">A_er</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="p">(</span><span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">B_er</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

                    <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">]</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">dimension</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                        <span class="n">ellipse</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a_er</span><span class="p">,</span>
                                                                 <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">b_er</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                                                 <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span>
                                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span>
                                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">),</span>
                                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span>
                                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>

                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">a_er</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">a_er</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="p">(</span><span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">b_er</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

                    <span class="c1"># ARC</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

                    <span class="c1"># calculate new shift</span>
                    <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

                    <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">]</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

                    <span class="c1"># ARC</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">dimension</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                        <span class="n">ellipse</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a_er</span><span class="p">,</span>
                                                                 <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">b_er</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                                                 <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span>
                                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span>
                                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">),</span>
                                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span>
                                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>

                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">a_er</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">a_er</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="p">(</span><span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">b_er</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">])</span>

                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                <span class="c1"># half of bounding box is required,</span>
                <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                            <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">])</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

                <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

                <span class="c1"># ARC</span>
                <span class="c1"># half of bounding box is required,</span>
                <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                            <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">])</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

                <span class="c1"># calculate new shift</span>
                <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">lft_el</span><span class="p">)</span>
                <span class="c1"># ic(shift)</span>

        <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">n_cell</span><span class="p">:</span>
            <span class="c1"># DRAW ARC:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># DRAW LINE CONNECTING ARCS</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># flat top</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">lft</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">lft</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
            <span class="c1"># half of bounding box is required,</span>
            <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">lft</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">lft</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">lft</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">lft</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">lft</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># ARC</span>
            <span class="c1"># half of bounding box is required,</span>
            <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">lft</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">lft</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">lft</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># calculate new shift</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">lft</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># DRAW ARC:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># DRAW LINE CONNECTING ARCS</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># flat top</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
            <span class="c1"># half of bounding box is required,</span>
            <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

            <span class="c1"># ARC</span>
            <span class="c1"># half of bounding box is required,</span>
            <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">])</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># BEAM PIPE</span>
    <span class="c1"># reset shift</span>

    <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">lft</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">lft_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span>
        <span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">lft</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
        <span class="n">Ri_er</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">L_bp_r</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">lft</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span>
              <span class="n">Ri_er</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># END PATH</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">lft</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                 <span class="n">step</span><span class="p">)</span>  <span class="c1"># to add beam pipe to right</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">lft</span> <span class="o">+</span> <span class="n">lft_el</span> <span class="o">+</span> <span class="n">lft_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="c1"># lineTo(pt, [2 * n_cell * L_er + L_bp_l - shift, 0], step)</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># CLOSE PATH</span>
    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">])</span>

    <span class="c1"># write geometry</span>
    <span class="k">if</span> <span class="n">write</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">])</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">write</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Check file path:: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="c1"># append start point</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">bc</span><span class="p">:</span>
        <span class="c1"># draw right boundary condition</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">shift</span><span class="p">,</span> <span class="n">shift</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">Ri_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">],</span>
                <span class="p">[</span><span class="n">shift</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">shift</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ri_er</span><span class="p">],</span>
                <span class="p">[</span><span class="n">shift</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">shift</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">Ri_er</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1"># CLOSE PATH</span>
    <span class="c1"># lineTo(pt, start_point, step)</span>
    <span class="c1"># geo.append([start_point[1], start_point[0], 3])</span>

    <span class="n">geo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dimension</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">geo</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">geo</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># recenter asymmetric cavity to center</span>
            <span class="n">shift_left</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">n_cell</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">shift_to_center</span> <span class="o">=</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_r</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shift_to_center</span> <span class="o">=</span> <span class="n">n_cell</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_r</span>

            <span class="n">top</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">geo</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift_left</span> <span class="o">+</span> <span class="n">shift_to_center</span><span class="p">,</span> <span class="n">geo</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># bottom = ax.plot(geo[:, 1] - shift_left + shift_to_center, -geo[:, 0], c=top[0].get_color(), **kwargs)</span>

        <span class="c1"># plot legend wthout duplicates</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">by_label</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">handles</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">by_label</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">by_label</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="writeCavityForMultipac">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.writeCavityForMultipac">[docs]</a>
<span class="k">def</span> <span class="nf">writeCavityForMultipac</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">n_cell</span><span class="p">,</span> <span class="n">mid_cell</span><span class="p">,</span> <span class="n">end_cell_left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_cell_right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">beampipe</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                           <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write cavity geometry</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_path: str</span>
<span class="sd">        File path to write geometry to</span>
<span class="sd">    n_cell: int</span>
<span class="sd">        Number of cavity cells</span>
<span class="sd">    mid_cell: list, ndarray</span>
<span class="sd">        Array of cavity middle cells&#39; geometric parameters</span>
<span class="sd">    end_cell_left: list, ndarray</span>
<span class="sd">        Array of cavity left end cell&#39;s geometric parameters</span>
<span class="sd">    end_cell_right: list, ndarray</span>
<span class="sd">        Array of cavity left end cell&#39;s geometric parameters</span>
<span class="sd">    beampipe: str {&quot;left&quot;, &quot;right&quot;, &quot;both&quot;, &quot;none&quot;}</span>
<span class="sd">        Specify if beam pipe is on one or both ends or at no end at all</span>
<span class="sd">    plot: bool</span>
<span class="sd">        If True, the cavity geometry is plotted for viewing</span>

<span class="sd">    scale</span>
<span class="sd">    unit</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">end_cell_left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">end_cell_left</span> <span class="o">=</span> <span class="n">mid_cell</span>

    <span class="k">if</span> <span class="n">end_cell_right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">end_cell_left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">end_cell_right</span> <span class="o">=</span> <span class="n">mid_cell</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">end_cell_right</span> <span class="o">=</span> <span class="n">end_cell_left</span>

    <span class="n">us</span> <span class="o">=</span> <span class="n">unit</span> <span class="o">*</span> <span class="n">scale</span>
    <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mid_cell</span><span class="p">[:</span><span class="mi">7</span><span class="p">])</span> <span class="o">*</span> <span class="n">us</span>
    <span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">,</span> <span class="n">L_el</span><span class="p">,</span> <span class="n">Req</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">end_cell_left</span><span class="p">[:</span><span class="mi">7</span><span class="p">])</span> <span class="o">*</span> <span class="n">us</span>
    <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="n">L_er</span><span class="p">,</span> <span class="n">Req</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">end_cell_right</span><span class="p">[:</span><span class="mi">7</span><span class="p">])</span> <span class="o">*</span> <span class="n">us</span>

    <span class="n">step</span> <span class="o">=</span> <span class="mf">0.005</span>

    <span class="k">if</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">L_m</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">L_m</span>
    <span class="k">elif</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>  <span class="c1"># 4 * L_m  #</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>  <span class="c1"># 4 * L_m  #</span>
    <span class="k">elif</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">L_m</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>
    <span class="k">elif</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">L_m</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>  <span class="c1"># 4 * L_m  #</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>  <span class="c1"># 4 * L_m  #</span>

    <span class="c1"># calculate shift</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># calculate angles outside loop</span>
    <span class="c1"># CALCULATE x1_el, y1_el, x2_el, y2_el</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">,</span> <span class="n">L_el</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">L_bp_l</span><span class="p">)</span>
    <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">,</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Parameter set leads to degenerate geometry.&#39;</span><span class="p">)</span>
        <span class="c1"># save figure of error</span>
        <span class="k">return</span>

    <span class="c1"># CALCULATE x1, y1, x2, y2</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">L_bp_l</span><span class="p">)</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Parameter set leads to degenerate geometry.&#39;</span><span class="p">)</span>
        <span class="c1"># save figure of error</span>
        <span class="k">return</span>

    <span class="c1"># CALCULATE x1_er, y1_er, x2_er, y2_er</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="n">L_er</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">L_bp_r</span><span class="p">)</span>
    <span class="n">x1er</span><span class="p">,</span> <span class="n">y1er</span><span class="p">,</span> <span class="n">x2er</span><span class="p">,</span> <span class="n">y2er</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Parameter set leads to degenerate geometry.&#39;</span><span class="p">)</span>
        <span class="c1"># save figure of error</span>
        <span class="k">return</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fil</span><span class="p">:</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   2.0000000e-03   0.0000000e+00   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   1.25000000e-02   0.0000000e+00   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># a point inside the structure</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  -3.1415927e+00  -2.7182818e+00   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># a point outside the structure</span>

        <span class="c1"># SHIFT POINT TO START POINT</span>
        <span class="n">start_point</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   3.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">]</span>
        <span class="c1"># for pp in pts:</span>
        <span class="c1">#     fil.write(f&quot;  {pp[1]:.16E}  {pp[0]:.16E}   1.0000000e+00   1.0000000e+00\n&quot;)</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># ADD BEAM PIPE LENGTH</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cell</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># DRAW ARC:</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># DRAW LINE CONNECTING ARCS</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span>
                            <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">n_cell</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># ARC</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>

                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># calculate new shift</span>
                    <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># ARC</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># calculate new shift</span>
                    <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">n_cell</span><span class="p">:</span>
                <span class="c1"># DRAW ARC:</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># DRAW LINE CONNECTING ARCS</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                <span class="c1"># half of bounding box is required,</span>
                <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                            <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># ARC</span>
                <span class="c1"># half of bounding box is required,</span>
                <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                            <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># calculate new shift</span>
                <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># DRAW ARC:</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># DRAW LINE CONNECTING ARCS</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                <span class="c1"># half of bounding box is required,</span>
                <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                            <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># ARC</span>
                <span class="c1"># half of bounding box is required,</span>
                <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                            <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># BEAM PIPE</span>
        <span class="c1"># reset shift</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   3.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># END PATH</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span>
                     <span class="n">plot</span><span class="p">)</span>  <span class="c1"># to add beam pipe to right</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># lineTo(pt, [2 * n_cell * L_er + L_bp_l - shift, 0], step)</span>
        <span class="c1"># pt = [2 * n_cell * L_er + L_bp_l - shift, 0]</span>
        <span class="c1"># for pp in pts:</span>
        <span class="c1">#     fil.write(f&quot;  {pp[1]:.16E}  {pp[0]:.16E}   1.0000000e+00   1.0000000e+00\n&quot;)</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># CLOSE PATH</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
        <span class="c1"># for pp in pts:</span>
        <span class="c1">#     fil.write(f&quot;  {pp[1]:.16E}  {pp[0]:.16E}   1.0000000e+00   1.0000000e+00\n&quot;)</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParamsDefault</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="writeCavityForMultipac_multicell">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.writeCavityForMultipac_multicell">[docs]</a>
<span class="k">def</span> <span class="nf">writeCavityForMultipac_multicell</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">n_cell</span><span class="p">,</span> <span class="n">mid_cell</span><span class="p">,</span> <span class="n">end_cell_left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_cell_right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">beampipe</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                     <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write cavity geometry</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_path: str</span>
<span class="sd">        File path to write geometry to</span>
<span class="sd">    n_cell: int</span>
<span class="sd">        Number of cavity cells</span>
<span class="sd">    mid_cell: list, ndarray</span>
<span class="sd">        Array of cavity middle cells&#39; geometric parameters</span>
<span class="sd">    end_cell_left: list, ndarray</span>
<span class="sd">        Array of cavity left end cell&#39;s geometric parameters</span>
<span class="sd">    end_cell_right: list, ndarray</span>
<span class="sd">        Array of cavity left end cell&#39;s geometric parameters</span>
<span class="sd">    beampipe: str {&quot;left&quot;, &quot;right&quot;, &quot;both&quot;, &quot;none&quot;}</span>
<span class="sd">        Specify if beam pipe is on one or both ends or at no end at all</span>
<span class="sd">    plot: bool</span>
<span class="sd">        If True, the cavity geometry is plotted for viewing</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">end_cell_left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">end_cell_left</span> <span class="o">=</span> <span class="n">mid_cell</span>

    <span class="k">if</span> <span class="n">end_cell_right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">end_cell_left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">end_cell_right</span> <span class="o">=</span> <span class="n">mid_cell</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">end_cell_right</span> <span class="o">=</span> <span class="n">end_cell_left</span>

    <span class="n">us</span> <span class="o">=</span> <span class="n">unit</span> <span class="o">*</span> <span class="n">scale</span>
    <span class="n">A_m_array</span><span class="p">,</span> <span class="n">B_m_array</span><span class="p">,</span> <span class="n">a_m_array</span><span class="p">,</span> <span class="n">b_m_array</span><span class="p">,</span> <span class="n">Ri_m_array</span><span class="p">,</span> <span class="n">L_m_array</span><span class="p">,</span> <span class="n">Req_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mid_cell</span><span class="p">[:</span><span class="mi">7</span><span class="p">])</span> <span class="o">*</span> <span class="n">us</span>
    <span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">,</span> <span class="n">L_el</span><span class="p">,</span> <span class="n">Req_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">end_cell_left</span><span class="p">[:</span><span class="mi">7</span><span class="p">])</span> <span class="o">*</span> <span class="n">us</span>
    <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="n">L_er</span><span class="p">,</span> <span class="n">Req_er</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">end_cell_right</span><span class="p">[:</span><span class="mi">7</span><span class="p">])</span> <span class="o">*</span> <span class="n">us</span>
    <span class="c1"># ic(np.array(mid_cell[:7]), np.array(mid_cell[:7]).shape)</span>

    <span class="n">step</span> <span class="o">=</span> <span class="mf">0.005</span>

    <span class="k">if</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">L_el</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">L_el</span>
    <span class="k">elif</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>  <span class="c1"># 4 * L_m  #</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>  <span class="c1"># 4 * L_m  #</span>
    <span class="k">elif</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">L_el</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>
    <span class="k">elif</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">L_el</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>  <span class="c1"># 4 * L_m  #</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>  <span class="c1"># 4 * L_m  #</span>

    <span class="c1"># calculate shift</span>
    <span class="k">if</span> <span class="n">n_cell</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">L_m_array</span><span class="p">)</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># calculate angles outside loop</span>
    <span class="c1"># CALCULATE x1_el, y1_el, x2_el, y2_el</span>

    <span class="c1"># enforce welding by average equator radius between adjacent cells</span>
    <span class="k">if</span> <span class="n">n_cell</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># ic(Req_array)</span>
        <span class="n">Req_el</span> <span class="o">=</span> <span class="p">(</span><span class="n">Req_el</span> <span class="o">+</span> <span class="n">Req_array</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Req_el</span> <span class="o">=</span> <span class="p">(</span><span class="n">Req_el</span> <span class="o">+</span> <span class="n">Req_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">,</span> <span class="n">L_el</span><span class="p">,</span> <span class="n">Req_el</span><span class="p">,</span> <span class="n">L_bp_l</span><span class="p">)</span>
    <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">,</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># # CALCULATE x1, y1, x2, y2</span>
    <span class="c1"># A_m, B_m, a_m, b_m, Ri_m, L_m, Req_m = A_m_array[0], B_m_array[0], a_m_array[0], b_m_array[0], Ri_m_array[0], L_m_array[0], Req_array[0]</span>
    <span class="c1"># df = tangent_coords(A_m, B_m, a_m, b_m, Ri_m, L_m, Req_el, L_bp_l)</span>
    <span class="c1"># x1, y1, x2, y2 = df[0]</span>

    <span class="c1"># # CALCULATE x1_er, y1_er, x2_er, y2_er</span>
    <span class="c1"># df = tangent_coords(A_er, B_er, a_er, b_er, Ri_er, L_er, Req_m, L_bp_r)</span>
    <span class="c1"># x1er, y1er, x2er, y2er = df[0]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fil</span><span class="p">:</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   2.0000000e-03   0.0000000e+00   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   1.25000000e-02   0.0000000e+00   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># a point inside the structure</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  -3.1415927e+00  -2.7182818e+00   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># a point outside the structure</span>

        <span class="c1"># SHIFT POINT TO START POINT</span>
        <span class="n">start_point</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   3.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">]</span>
        <span class="c1"># for pp in pts:</span>
        <span class="c1">#     fil.write(f&quot;  {pp[1]:.16E}  {pp[0]:.16E}   1.0000000e+00   1.0000000e+00\n&quot;)</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># ADD BEAM PIPE LENGTH</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cell</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># DRAW ARC:</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># DRAW LINE CONNECTING ARCS</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_el</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_el</span><span class="p">],</span>
                            <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_el</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">n_cell</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>

                    <span class="c1"># change parameters to right end cell parameters</span>
                    <span class="c1"># CALCULATE x1_er, y1_er, x2_er, y2_er</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="n">L_er</span><span class="p">,</span> <span class="n">Req_el</span><span class="p">,</span> <span class="n">L_bp_r</span><span class="p">)</span>
                    <span class="n">x1er</span><span class="p">,</span> <span class="n">y1er</span><span class="p">,</span> <span class="n">x2er</span><span class="p">,</span> <span class="n">y2er</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_el</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># ARC</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>

                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># calculate new shift</span>
                    <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>

                    <span class="c1"># change midcell parameters</span>
                    <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req_m</span> <span class="o">=</span> <span class="n">A_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">B_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">a_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span>
                        <span class="mi">0</span><span class="p">],</span> \
                        <span class="n">b_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ri_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Req_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="c1"># enforce welding by average iris radius between adjacent cells</span>
                    <span class="n">Ri_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ri_m</span> <span class="o">+</span> <span class="n">Ri_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

                    <span class="c1"># CALCULATE x1, y1, x2, y2</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req_el</span><span class="p">,</span> <span class="n">L_bp_l</span><span class="p">)</span>
                    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_el</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># ARC</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># calculate new shift</span>
                    <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">n_cell</span><span class="p">:</span>
                <span class="c1"># ic(n)</span>
                <span class="c1"># change mid cell parameters</span>
                <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req_m</span> <span class="o">=</span> <span class="n">A_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">B_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">a_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> \
                    <span class="n">b_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Ri_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Req_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># enforce welding by average equator radius between adjacent cells</span>
                <span class="n">Req_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">Req_m</span> <span class="o">+</span> <span class="n">Req_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="c1"># CALCULATE x1, y1, x2, y2</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">,</span> <span class="n">L_bp_l</span><span class="p">)</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># DRAW ARC:</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># DRAW LINE CONNECTING ARCS</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># change midcell parameters</span>
                <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">A_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">B_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> \
                    <span class="n">a_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> \
                    <span class="n">b_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ri_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> \
                    <span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Req_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># enforce welding by average iris radius between adjacent cells</span>
                <span class="n">Ri_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ri_m</span> <span class="o">+</span> <span class="n">Ri_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="c1"># CALCULATE x1, y1, x2, y2</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">,</span> <span class="n">L_bp_l</span><span class="p">)</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                <span class="c1"># half of bounding box is required,</span>
                <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                            <span class="p">[</span><span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># ARC</span>
                <span class="c1"># half of bounding box is required,</span>
                <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                            <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># calculate new shift</span>
                <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="p">(</span><span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># change midcell parameters</span>
                <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req_m</span> <span class="o">=</span> <span class="n">A_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">B_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">a_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> \
                    <span class="n">b_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Ri_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">L_m_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Req_array</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># enforce welding by average equator radius between adjacent cells</span>
                <span class="n">Req_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">Req_m</span> <span class="o">+</span> <span class="n">Req_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="c1"># CALCULATE x1, y1, x2, y2</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">,</span> <span class="n">L_bp_l</span><span class="p">)</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># DRAW ARC:</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># DRAW LINE CONNECTING ARCS</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># change parameters to right end cell parameters</span>
                <span class="c1"># CALCULATE x1_er, y1_er, x2_er, y2_er</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">tangent_coords</span><span class="p">(</span><span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="n">L_er</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">,</span> <span class="n">L_bp_r</span><span class="p">)</span>
                <span class="n">x1er</span><span class="p">,</span> <span class="n">y1er</span><span class="p">,</span> <span class="n">x2er</span><span class="p">,</span> <span class="n">y2er</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                <span class="c1"># half of bounding box is required,</span>
                <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                            <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># ARC</span>
                <span class="c1"># half of bounding box is required,</span>
                <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                            <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">],</span> <span class="n">plot</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># BEAM PIPE</span>
        <span class="c1"># reset shift</span>
        <span class="k">if</span> <span class="n">n_cell</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   3.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># END PATH</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span>
                         <span class="n">plot</span><span class="p">)</span>  <span class="c1"># to add beam pipe to right</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="c1"># lineTo(pt, [2 * n_cell * L_er + L_bp_l - shift, 0], step)</span>
            <span class="c1"># pt = [2 * n_cell * L_er + L_bp_l - shift, 0]</span>
            <span class="c1"># for pp in pts:</span>
            <span class="c1">#     fil.write(f&quot;  {pp[1]:.16E}  {pp[0]:.16E}   1.0000000e+00   1.0000000e+00\n&quot;)</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># CLOSE PATH</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
            <span class="c1"># for pp in pts:</span>
            <span class="c1">#     fil.write(f&quot;  {pp[1]:.16E}  {pp[0]:.16E}   1.0000000e+00   1.0000000e+00\n&quot;)</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">L_m_array</span><span class="p">)</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">L_m_array</span><span class="p">)</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">L_m_array</span><span class="p">)</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   3.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># END PATH</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">L_m_array</span><span class="p">)</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span>
                         <span class="n">plot</span><span class="p">)</span>  <span class="c1"># to add beam pipe to right</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">L_m_array</span><span class="p">)</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="c1"># lineTo(pt, [2 * n_cell * L_er + L_bp_l - shift, 0], step)</span>
            <span class="c1"># pt = [2 * n_cell * L_er + L_bp_l - shift, 0]</span>
            <span class="c1"># for pp in pts:</span>
            <span class="c1">#     fil.write(f&quot;  {pp[1]:.16E}  {pp[0]:.16E}   1.0000000e+00   1.0000000e+00\n&quot;)</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># CLOSE PATH</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
            <span class="c1"># for pp in pts:</span>
            <span class="c1">#     fil.write(f&quot;  {pp[1]:.16E}  {pp[0]:.16E}   1.0000000e+00   1.0000000e+00\n&quot;)</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParamsDefault</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="plot_pillbox_geometry">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.plot_pillbox_geometry">[docs]</a>
<span class="k">def</span> <span class="nf">plot_pillbox_geometry</span><span class="p">(</span><span class="n">n_cell</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">L_bp</span><span class="p">,</span> <span class="n">beampipe</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_cell</span>
<span class="sd">    L</span>
<span class="sd">    Req</span>
<span class="sd">    Ri</span>
<span class="sd">    S</span>
<span class="sd">    L_bp</span>
<span class="sd">    beampipe</span>
<span class="sd">    plot</span>
<span class="sd">    kwargs</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">L_bp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">L_bp</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>

    <span class="n">step</span> <span class="o">=</span> <span class="mf">0.001</span>

    <span class="k">if</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="n">L_bp</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="n">L_bp</span>
    <span class="k">elif</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>  <span class="c1"># 4 * L_m  #</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>  <span class="c1"># 4 * L_m  #</span>
    <span class="k">elif</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="n">L_bp</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>
    <span class="k">elif</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="n">L_bp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>  <span class="c1"># 4 * L_m  #</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>  <span class="c1"># 4 * L_m  #</span>

    <span class="n">geo</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">n_cell</span> <span class="o">*</span> <span class="n">L</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># SHIFT POINT TO START POINT</span>
    <span class="n">start_point</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="n">lineTo</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri</span><span class="p">]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="c1"># add beampipe</span>
    <span class="k">if</span> <span class="n">L_bp_l</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Ri</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Ri</span><span class="p">]</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cell</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Ri</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Ri</span><span class="p">]</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="n">shift</span> <span class="o">-=</span> <span class="n">L</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span><span class="p">,</span> <span class="n">Ri</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span><span class="p">,</span> <span class="n">Ri</span><span class="p">]</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Ri</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Ri</span><span class="p">]</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="n">shift</span> <span class="o">-=</span> <span class="n">L</span>

    <span class="k">if</span> <span class="n">L_bp_r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="n">Ri</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="n">Ri</span><span class="p">]</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="c1"># END PATH</span>
    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="c1"># if bc:</span>
    <span class="c1">#     # draw right boundary condition</span>
    <span class="c1">#     ax.plot([shift, shift], [-Ri_er, Ri_er],</span>
    <span class="c1">#             [shift + 0.2 * L_m, shift + 0.2 * L_m], [-0.5 * Ri_er, 0.5 * Ri_er],</span>
    <span class="c1">#             [shift + 0.4 * L_m, shift + 0.4 * L_m], [-0.1 * Ri_er, 0.1 * Ri_er], c=&#39;b&#39;, lw=4, zorder=100)</span>

    <span class="c1"># CLOSE PATH</span>
    <span class="c1"># lineTo(pt, start_point, step)</span>
    <span class="c1"># geo.append([start_point[1], start_point[0]])</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>

    <span class="n">top</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">geo</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">geo</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">bottom</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">geo</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">geo</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># plot legend without duplicates</span>
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">by_label</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">handles</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">by_label</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">by_label</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span></div>



<div class="viewcode-block" id="write_gun_geometry">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.write_gun_geometry">[docs]</a>
<span class="k">def</span> <span class="nf">write_gun_geometry</span><span class="p">(</span><span class="n">write</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">y1</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">L3</span><span class="p">,</span> <span class="n">R4</span><span class="p">,</span> <span class="n">L5</span><span class="p">,</span> <span class="n">R6</span><span class="p">,</span> <span class="n">L7</span><span class="p">,</span> <span class="n">R8</span><span class="p">,</span>  <span class="n">T9</span><span class="p">,</span> <span class="n">R10</span><span class="p">,</span> <span class="n">T10</span><span class="p">,</span> <span class="n">L11</span><span class="p">,</span> <span class="n">R12</span><span class="p">,</span> <span class="n">L13</span><span class="p">,</span> <span class="n">R14</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> \
        <span class="p">[</span><span class="mf">1.5</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">45</span><span class="p">),</span> <span class="mi">24</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mi">5</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mi">11</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mi">19</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="mi">3</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span> <span class="mi">5</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">]</span>

    <span class="c1"># calcualte R9</span>
    <span class="n">R9</span> <span class="o">=</span> <span class="p">(((</span><span class="n">y1</span><span class="o">+</span><span class="n">R2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T2</span><span class="p">)</span> <span class="o">+</span> <span class="n">L3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T2</span><span class="p">)</span> <span class="o">+</span> <span class="n">R4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T2</span><span class="p">)</span> <span class="o">+</span> <span class="n">L5</span> <span class="o">+</span> <span class="n">R6</span><span class="p">)</span> <span class="o">-</span>
         <span class="p">(</span><span class="n">R14</span> <span class="o">+</span> <span class="n">L13</span> <span class="o">+</span> <span class="n">R12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T10</span><span class="p">)</span> <span class="o">+</span> <span class="n">L11</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T10</span><span class="p">)</span> <span class="o">+</span> <span class="n">R10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T10</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="n">R8</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T9</span><span class="p">)))))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T9</span><span class="p">)</span>

    <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="mf">1e-3</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">start_pt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">start_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">])</span>
    <span class="c1"># DRAW LINE CONNECTING ARCS</span>
    <span class="n">lineTo</span><span class="p">(</span><span class="n">start_pt</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">])</span>

    <span class="c1"># DRAW ARC:</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcToTheta</span><span class="p">(</span><span class="o">-</span><span class="n">R2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">R2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T2</span><span class="p">)</span><span class="o">-</span><span class="n">R2</span><span class="p">,</span> <span class="n">y1</span><span class="o">+</span><span class="n">R2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T2</span><span class="p">)],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">R2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T2</span><span class="p">)</span><span class="o">-</span><span class="n">R2</span><span class="p">,</span> <span class="n">y1</span><span class="o">+</span><span class="n">R2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T2</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># line</span>
    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">R2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T2</span><span class="p">)</span><span class="o">-</span><span class="n">R2</span><span class="o">-</span><span class="n">L3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T2</span><span class="p">),</span> <span class="n">y1</span><span class="o">+</span><span class="n">R2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T2</span><span class="p">)</span><span class="o">+</span><span class="n">L3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T2</span><span class="p">)],</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">R2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T2</span><span class="p">)</span><span class="o">-</span><span class="n">R2</span><span class="o">-</span><span class="n">L3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T2</span><span class="p">),</span> <span class="n">y1</span><span class="o">+</span><span class="n">R2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T2</span><span class="p">)</span><span class="o">+</span><span class="n">L3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T2</span><span class="p">)]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># DRAW ARC:</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcToTheta</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">R4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T2</span><span class="p">),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">R4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T2</span><span class="p">),</span> <span class="n">R4</span><span class="p">,</span> <span class="n">R4</span><span class="p">,</span>
                     <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">R4</span><span class="o">-</span><span class="n">R4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T2</span><span class="p">)),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">R4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T2</span><span class="p">)],</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">T2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">R4</span><span class="o">-</span><span class="n">R4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T2</span><span class="p">)),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">R4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T2</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># line</span>
    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">L5</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">L5</span><span class="p">]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># DRAW ARC:</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcToTheta</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">R6</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">R6</span><span class="p">,</span> <span class="n">R6</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">R6</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">R6</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">R6</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">R6</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># line</span>
    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">L7</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">L7</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># DRAW ARC:</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcToTheta</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">R8</span><span class="p">,</span> <span class="n">R8</span><span class="p">,</span> <span class="n">R8</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">R8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T9</span><span class="p">),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">R8</span><span class="o">-</span><span class="n">R8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T9</span><span class="p">))],</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">T9</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">R8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T9</span><span class="p">),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">R8</span><span class="o">-</span><span class="n">R8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T9</span><span class="p">))]</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># DRAW ARC:</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcToTheta</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">R9</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T9</span><span class="p">),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span><span class="n">R9</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T9</span><span class="p">),</span> <span class="n">R9</span><span class="p">,</span> <span class="n">R9</span><span class="p">,</span>
                     <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">R9</span><span class="o">-</span><span class="n">R9</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T9</span><span class="p">)),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R9</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T9</span><span class="p">)],</span> <span class="n">T9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">R9</span><span class="o">-</span><span class="n">R9</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T9</span><span class="p">)),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R9</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T9</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># DRAW ARC:</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcToTheta</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">R10</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">R10</span><span class="p">,</span> <span class="n">R10</span><span class="p">,</span>
                     <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">R10</span><span class="o">-</span><span class="n">R10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T10</span><span class="p">)),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T10</span><span class="p">)],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">T10</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">R10</span><span class="o">-</span><span class="n">R10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T10</span><span class="p">)),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T10</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># line</span>
    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">L11</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T10</span><span class="p">),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">L11</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T10</span><span class="p">)],</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">L11</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T10</span><span class="p">),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">L11</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T10</span><span class="p">)]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># DRAW ARC:</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcToTheta</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">R12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T10</span><span class="p">),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T10</span><span class="p">),</span> <span class="n">R12</span><span class="p">,</span> <span class="n">R12</span><span class="p">,</span>
                     <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">R12</span><span class="o">-</span><span class="n">R12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T10</span><span class="p">)),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T10</span><span class="p">)],</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">T10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">R12</span><span class="o">-</span><span class="n">R12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">T10</span><span class="p">)),</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">T10</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># line</span>
    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">L13</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">L13</span><span class="p">]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># DRAW ARC:</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">arcToTheta</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">R14</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">R14</span><span class="p">,</span> <span class="n">R14</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">R14</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R14</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">R14</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R14</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># line</span>
    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">*</span><span class="n">y1</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">*</span><span class="n">y1</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># line</span>
    <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">])</span>

    <span class="n">start_pt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">start_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">])</span>

    <span class="c1"># pandss</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
    <span class="c1"># print(df[df.duplicated(keep=False)])</span>

    <span class="n">geo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">geo</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="n">geo</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;length of geometry:: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">geo</span><span class="p">))</span>

    <span class="n">top</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">geo</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">geo</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">bottom</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">geo</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">geo</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>

    <span class="c1"># plot legend wthout duplicates</span>
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">by_label</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">handles</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">by_label</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">by_label</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=-</span><span class="mi">30</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">)</span>

    <span class="c1"># write geometry</span>
    <span class="k">if</span> <span class="n">write</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;bc&#39;</span><span class="p">])</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">write</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Check file path:: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span></div>



<div class="viewcode-block" id="write_pillbox_geometry">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.write_pillbox_geometry">[docs]</a>
<span class="k">def</span> <span class="nf">write_pillbox_geometry</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">n_cell</span><span class="p">,</span> <span class="n">cell_par</span><span class="p">,</span> <span class="n">beampipe</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_path</span>
<span class="sd">    n_cell</span>
<span class="sd">    cell_par</span>
<span class="sd">    beampipe</span>
<span class="sd">    plot</span>
<span class="sd">    kwargs</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">L_bp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cell_par</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span>

    <span class="n">step</span> <span class="o">=</span> <span class="mf">0.001</span>

    <span class="k">if</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="n">L_bp</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="n">L_bp</span>
    <span class="k">elif</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>
    <span class="k">elif</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="n">L_bp</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>
    <span class="k">elif</span> <span class="n">beampipe</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="n">L_bp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.000</span>
        <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.000</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fil</span><span class="p">:</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">n_cell</span> <span class="o">*</span> <span class="n">L</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># SHIFT POINT TO START POINT</span>
        <span class="n">start_point</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">lineTo</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri</span><span class="p">]</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># add beampipe</span>
        <span class="k">if</span> <span class="n">L_bp_l</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Ri</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Ri</span><span class="p">]</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cell</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Ri</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Ri</span><span class="p">]</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">shift</span> <span class="o">-=</span> <span class="n">L</span>
            <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span><span class="p">,</span> <span class="n">Ri</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span><span class="p">,</span> <span class="n">Ri</span><span class="p">]</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">]</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Ri</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">Ri</span><span class="p">]</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">shift</span> <span class="o">-=</span> <span class="n">L</span>

        <span class="k">if</span> <span class="n">L_bp_r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="n">Ri</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="n">Ri</span><span class="p">]</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># END PATH</span>
        <span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.16E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


        <span class="c1"># if bc:</span>
        <span class="c1">#     # draw right boundary condition</span>
        <span class="c1">#     ax.plot([shift, shift], [-Ri_er, Ri_er],</span>
        <span class="c1">#             [shift + 0.2 * L_m, shift + 0.2 * L_m], [-0.5 * Ri_er, 0.5 * Ri_er],</span>
        <span class="c1">#             [shift + 0.4 * L_m, shift + 0.4 * L_m], [-0.1 * Ri_er, 0.1 * Ri_er], c=&#39;b&#39;, lw=4, zorder=100)</span>

        <span class="c1"># CLOSE PATH</span>
        <span class="c1"># lineTo(pt, start_point, step)</span>
        <span class="c1"># geo.append([start_point[1], start_point[0]])</span>

    <span class="c1"># top = plt.gca().plot(geo[:, 1], geo[:, 0], **kwargs)</span>
    <span class="c1"># bottom = plt.gca().plot(geo[:, 1], -geo[:, 0], c=top[0].get_color(), **kwargs)</span>
    <span class="c1">#</span>
    <span class="c1"># # plot legend without duplicates</span>
    <span class="c1"># handles, labels = plt.gca().get_legend_handles_labels()</span>
    <span class="c1"># by_label = dict(zip(labels, handles))</span>
    <span class="c1"># plt.legend(by_label.values(), by_label.keys())</span>


<div class="viewcode-block" id="f2b_slashes">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.f2b_slashes">[docs]</a>
<span class="k">def</span> <span class="nf">f2b_slashes</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replaces forward slashes with backward slashes for windows OS</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        Directory path</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_qoi_value">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.get_qoi_value">[docs]</a>
<span class="k">def</span> <span class="nf">get_qoi_value</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the quantities of interest from simulation results</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    d: dict</span>
<span class="sd">        Dictionary containing several figures of merits from eigenmode solver</span>
<span class="sd">    obj: list</span>
<span class="sd">        List of objective functions</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Req = d[&#39;CAVITY RADIUS&#39;][n_cells - 1] * 10  # convert to mm</span>
    <span class="c1"># Freq = d[&#39;FREQUENCY&#39;][n_cells - 1]</span>
    <span class="c1"># E_stored = d[&#39;STORED ENERGY&#39;][n_cells - 1]</span>
    <span class="c1"># # Rsh = d[&#39;SHUNT IMPEDANCE&#39;][n_cells-1]  # MOhm</span>
    <span class="c1"># Q = d[&#39;QUALITY FACTOR&#39;][n_cells - 1]</span>
    <span class="c1"># Epk = d[&#39;MAXIMUM ELEC. FIELD&#39;][n_cells - 1]  # MV/m</span>
    <span class="c1"># Hpk = d[&#39;MAXIMUM MAG. FIELD&#39;][n_cells - 1]  # A/m</span>
    <span class="c1"># # Vacc = dict[&#39;ACCELERATION&#39;][0]</span>
    <span class="c1"># # Eavg = d[&#39;AVERAGE E.FIELD ON AXIS&#39;][n_cells-1]  # MV/m</span>
    <span class="c1"># Rsh_Q = d[&#39;EFFECTIVE IMPEDANCE&#39;][n_cells - 1]  # Ohm</span>
    <span class="c1">#</span>
    <span class="c1"># Vacc = np.sqrt(</span>
    <span class="c1">#     2 * Rsh_Q * E_stored * 2 * np.pi * Freq * 1e6) * 1e-6</span>
    <span class="c1"># # factor of 2, remember circuit and accelerator definition</span>
    <span class="c1"># # Eacc = Vacc / (374 * 1e-3)  # factor of 2, remember circuit and accelerator definition</span>
    <span class="c1"># Eacc = Vacc / (norm_length * 1e-3)  # for 1 cell factor of 2, remember circuit and accelerator definition</span>
    <span class="c1"># Epk_Eacc = Epk / Eacc</span>
    <span class="c1"># Bpk_Eacc = (Hpk * 4 * np.pi * 1e-7) * 1e3 / Eacc</span>
    <span class="c1">#</span>
    <span class="c1"># d = {</span>
    <span class="c1">#     &quot;Req&quot;: Req,</span>
    <span class="c1">#     &quot;freq&quot;: Freq,</span>
    <span class="c1">#     &quot;Q&quot;: Q,</span>
    <span class="c1">#     &quot;E&quot;: E_stored,</span>
    <span class="c1">#     &quot;R/Q&quot;: 2 * Rsh_Q,</span>
    <span class="c1">#     &quot;Epk/Eacc&quot;: Epk_Eacc,</span>
    <span class="c1">#     &quot;Bpk/Eacc&quot;: Bpk_Eacc</span>
    <span class="c1"># }</span>

    <span class="n">objective</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># append objective functions</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">objective</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">o</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">objective</span></div>



<div class="viewcode-block" id="enforce_Req_continuity">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.enforce_Req_continuity">[docs]</a>
<span class="k">def</span> <span class="nf">enforce_Req_continuity</span><span class="p">(</span><span class="n">par_mid</span><span class="p">,</span> <span class="n">par_end_l</span><span class="p">,</span> <span class="n">par_end_r</span><span class="p">,</span> <span class="n">cell_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enforce continuity at iris and equator of cavities</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    par_mid</span>
<span class="sd">    par_end_l</span>
<span class="sd">    par_end_r</span>
<span class="sd">    cell_type</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">cell_type</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cell_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mid cell&#39;</span> <span class="ow">or</span> <span class="n">cell_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mid-cell&#39;</span> <span class="ow">or</span> <span class="n">cell_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mid_cell&#39;</span><span class="p">:</span>
            <span class="n">par_mid</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">par_end_r</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">par_end_l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">par_end_r</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">cell_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mid-end cell&#39;</span> <span class="ow">or</span> <span class="n">cell_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mid-end-cell&#39;</span> <span class="ow">or</span> <span class="n">cell_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mid_end_cell&#39;</span><span class="p">:</span>
            <span class="n">par_end_l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">par_mid</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">par_end_r</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">par_mid</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">cell_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;end-end cell&#39;</span> <span class="ow">or</span> <span class="n">cell_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;end-end-cell&#39;</span>
              <span class="ow">or</span> <span class="n">cell_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;end_end_cell&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cell_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;end end cell&#39;</span><span class="p">:</span>
            <span class="n">par_mid</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">par_end_r</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">par_end_l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">par_end_r</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">par_mid</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">par_end_r</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">par_end_l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">par_end_r</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Req_avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">par_mid</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">par_end_l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">par_end_r</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span><span class="o">/</span><span class="mi">3</span>
        <span class="n">par_mid</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">Req_avg</span>
        <span class="n">par_end_l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">Req_avg</span>
        <span class="n">par_end_r</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">Req_avg</span></div>



<div class="viewcode-block" id="save_tune_result">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.save_tune_result">[docs]</a>
<span class="k">def</span> <span class="nf">save_tune_result</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">sim_folder</span><span class="o">=</span><span class="s1">&#39;SLAN_Opt&#39;</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s2">\SimulationData\</span><span class="si">{</span><span class="n">sim_folder</span><span class="si">}</span><span class="s2">\</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">\</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span></div>



<div class="viewcode-block" id="to_multicell">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.to_multicell">[docs]</a>
<span class="k">def</span> <span class="nf">to_multicell</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
    <span class="n">shape_multicell</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">mid_cell</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">]</span>
    <span class="n">mid_cell_multi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">mid_cell</span><span class="p">])</span>

    <span class="n">shape_multicell</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">]</span>
    <span class="n">shape_multicell</span><span class="p">[</span><span class="s1">&#39;OC_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;OC_R&#39;</span><span class="p">]</span>
    <span class="n">shape_multicell</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mid_cell_multi</span>
    <span class="c1"># shape_multicell[&#39;BP&#39;] = shape[&#39;BP&#39;]</span>
    <span class="n">shape_multicell</span><span class="p">[</span><span class="s1">&#39;n_cells&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;n_cells&#39;</span><span class="p">]</span>
    <span class="n">shape_multicell</span><span class="p">[</span><span class="s1">&#39;CELL TYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;multicell&#39;</span>

    <span class="k">return</span> <span class="n">shape_multicell</span></div>



<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>


<div class="viewcode-block" id="interpolate_pareto">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.interpolate_pareto">[docs]</a>
<span class="k">def</span> <span class="nf">interpolate_pareto</span><span class="p">(</span><span class="n">pareto</span><span class="p">,</span> <span class="n">x_values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interpolate y-values for a given set of x-values based on a Pareto front.&quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">pareto</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pareto</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span></div>



<div class="viewcode-block" id="extend_pareto">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.extend_pareto">[docs]</a>
<span class="k">def</span> <span class="nf">extend_pareto</span><span class="p">(</span><span class="n">pareto1</span><span class="p">,</span> <span class="n">pareto2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extend Pareto fronts by adding boundary points to match their x-ranges.&quot;&quot;&quot;</span>
    <span class="n">x_min1</span><span class="p">,</span> <span class="n">x_max1</span> <span class="o">=</span> <span class="n">pareto1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">pareto1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">x_min2</span><span class="p">,</span> <span class="n">x_max2</span> <span class="o">=</span> <span class="n">pareto2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">pareto2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="c1"># Find boundary points to extend Pareto fronts</span>
    <span class="n">extend_left1</span> <span class="o">=</span> <span class="n">pareto2</span><span class="p">[</span><span class="n">pareto2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">x_min2</span><span class="p">]</span>
    <span class="n">extend_right1</span> <span class="o">=</span> <span class="n">pareto2</span><span class="p">[</span><span class="n">pareto2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">x_max2</span><span class="p">]</span>
    <span class="n">extend_left2</span> <span class="o">=</span> <span class="n">pareto1</span><span class="p">[</span><span class="n">pareto1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">x_min1</span><span class="p">]</span>
    <span class="n">extend_right2</span> <span class="o">=</span> <span class="n">pareto1</span><span class="p">[</span><span class="n">pareto1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">x_max1</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extend_left1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x_min1</span> <span class="o">&gt;</span> <span class="n">x_min2</span><span class="p">:</span>
        <span class="n">pareto1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">extend_left1</span><span class="p">,</span> <span class="n">pareto1</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extend_right1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x_max1</span> <span class="o">&lt;</span> <span class="n">x_max2</span><span class="p">:</span>
        <span class="n">pareto1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">pareto1</span><span class="p">,</span> <span class="n">extend_right1</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extend_left2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x_min2</span> <span class="o">&gt;</span> <span class="n">x_min1</span><span class="p">:</span>
        <span class="n">pareto2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">extend_left2</span><span class="p">,</span> <span class="n">pareto2</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extend_right2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x_max2</span> <span class="o">&lt;</span> <span class="n">x_max1</span><span class="p">:</span>
        <span class="n">pareto2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">pareto2</span><span class="p">,</span> <span class="n">extend_right2</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">pareto1</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">pareto2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>



<div class="viewcode-block" id="line_intersection">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.line_intersection">[docs]</a>
<span class="k">def</span> <span class="nf">line_intersection</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the intersection point of two line segments (p1 and p2).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">det</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">xdiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ydiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">div</span> <span class="o">=</span> <span class="n">det</span><span class="p">(</span><span class="n">xdiff</span><span class="p">,</span> <span class="n">ydiff</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">div</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Parallel lines</span>

    <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">det</span><span class="p">((</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">3</span><span class="p">])),</span> <span class="n">det</span><span class="p">((</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">det</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">xdiff</span><span class="p">)</span> <span class="o">/</span> <span class="n">div</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">det</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">ydiff</span><span class="p">)</span> <span class="o">/</span> <span class="n">div</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>



<div class="viewcode-block" id="find_all_intersections">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.find_all_intersections">[docs]</a>
<span class="k">def</span> <span class="nf">find_all_intersections</span><span class="p">(</span><span class="n">pareto1</span><span class="p">,</span> <span class="n">pareto2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find all intersection points between the segments of two Pareto fronts.&quot;&quot;&quot;</span>
    <span class="n">intersections</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pareto1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">pareto1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pareto1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pareto1</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pareto1</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pareto2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">pareto2</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pareto2</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pareto2</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pareto2</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">intersect_point</span> <span class="o">=</span> <span class="n">line_intersection</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">intersect_point</span><span class="p">:</span>
                <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">intersect_point</span>
                <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">xi</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">xi</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="n">intersections</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">intersections</span><span class="p">))</span></div>



<div class="viewcode-block" id="calculate_bounded_area">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.calculate_bounded_area">[docs]</a>
<span class="k">def</span> <span class="nf">calculate_bounded_area</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values1</span><span class="p">,</span> <span class="n">y_values2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the area between two Pareto fronts.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_values1</span> <span class="o">-</span> <span class="n">y_values2</span><span class="p">),</span> <span class="n">x_values</span><span class="p">))</span></div>



<div class="viewcode-block" id="area_pareto_fronts">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.area_pareto_fronts">[docs]</a>
<span class="k">def</span> <span class="nf">area_pareto_fronts</span><span class="p">(</span><span class="n">pareto1</span><span class="p">,</span> <span class="n">pareto2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the two Pareto fronts and correctly fill the area between them, handling edge cases.&quot;&quot;&quot;</span>
    <span class="c1"># Extend Pareto fronts to cover the same x-range</span>
    <span class="n">pareto1</span><span class="p">,</span> <span class="n">pareto2</span> <span class="o">=</span> <span class="n">extend_pareto</span><span class="p">(</span><span class="n">pareto1</span><span class="p">,</span> <span class="n">pareto2</span><span class="p">)</span>

    <span class="c1"># Determine the combined range of x-values</span>
    <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pareto1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">pareto2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pareto1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">pareto2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="c1"># Create a fine grid of x-values spanning the combined range</span>
    <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

    <span class="c1"># # Interpolate both Pareto fronts at these x-values</span>
    <span class="c1"># y_values1 = interpolate_pareto(pareto1, x_values)</span>
    <span class="c1"># y_values2 = interpolate_pareto(pareto2, x_values)</span>

    <span class="c1"># Find intersection points and split x_values accordingly</span>
    <span class="n">intersections</span> <span class="o">=</span> <span class="n">find_all_intersections</span><span class="p">(</span><span class="n">pareto1</span><span class="p">,</span> <span class="n">pareto2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">intersections</span><span class="p">:</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_values</span><span class="p">[(</span><span class="n">x_values</span> <span class="o">&gt;=</span> <span class="n">min_x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_values</span> <span class="o">&lt;=</span> <span class="n">intersections</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])]]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intersections</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_values</span><span class="p">[(</span><span class="n">x_values</span> <span class="o">&gt;=</span> <span class="n">intersections</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_values</span> <span class="o">&lt;=</span> <span class="n">intersections</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])])</span>
        <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_values</span><span class="p">[(</span><span class="n">x_values</span> <span class="o">&gt;=</span> <span class="n">intersections</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_values</span> <span class="o">&lt;=</span> <span class="n">max_x</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_values</span><span class="p">]</span>

    <span class="c1"># Calculate bounded area</span>
    <span class="n">total_area</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
        <span class="n">seg_y1</span> <span class="o">=</span> <span class="n">interpolate_pareto</span><span class="p">(</span><span class="n">pareto1</span><span class="p">,</span> <span class="n">segment</span><span class="p">)</span>
        <span class="n">seg_y2</span> <span class="o">=</span> <span class="n">interpolate_pareto</span><span class="p">(</span><span class="n">pareto2</span><span class="p">,</span> <span class="n">segment</span><span class="p">)</span>
        <span class="n">total_area</span> <span class="o">+=</span> <span class="n">calculate_bounded_area</span><span class="p">(</span><span class="n">segment</span><span class="p">,</span> <span class="n">seg_y1</span><span class="p">,</span> <span class="n">seg_y2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">total_area</span></div>

    <span class="c1"># print(f&#39;Bounded Area: {total_area:.2f}&#39;)</span>
    <span class="c1"># if intersections:</span>
    <span class="c1">#     print(&#39;Intersection Points:&#39;)</span>
    <span class="c1">#     for x, y in intersections:</span>
    <span class="c1">#         print(f&#39;X: {x:.2f}, Y: {y:.2f}&#39;)</span>
    <span class="c1">#</span>
    <span class="c1"># # Plot Pareto fronts</span>
    <span class="c1"># plt.plot(pareto1[:, 0], pareto1[:, 1], &#39;r-o&#39;, label=&#39;Pareto Front 1&#39;)</span>
    <span class="c1"># plt.plot(pareto2[:, 0], pareto2[:, 1], &#39;b-o&#39;, label=&#39;Pareto Front 2&#39;)</span>
    <span class="c1">#</span>
    <span class="c1"># # Fill the area between the two fronts in black</span>
    <span class="c1"># plt.fill_between(x_values, y_values1, y_values2, where=(y_values1 &gt; y_values2), color=&#39;black&#39;, alpha=0.3)</span>
    <span class="c1"># plt.fill_between(x_values, y_values1, y_values2, where=(y_values1 &lt;= y_values2), color=&#39;black&#39;, alpha=0.3)</span>
    <span class="c1">#</span>
    <span class="c1"># plt.xlabel(&#39;X-axis&#39;)</span>
    <span class="c1"># plt.ylabel(&#39;Y-axis&#39;)</span>
    <span class="c1"># plt.title(&#39;Area Between Two Pareto Fronts with Edge Cases&#39;)</span>
    <span class="c1"># plt.legend()</span>
    <span class="c1"># plt.show()</span>


<div class="viewcode-block" id="reorder_legend">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.reorder_legend">[docs]</a>
<span class="k">def</span> <span class="nf">reorder_legend</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">ncols</span><span class="p">):</span>
    <span class="n">re_h</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">h</span><span class="p">[</span><span class="n">ii</span><span class="p">::</span><span class="n">ncols</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncols</span><span class="p">)),</span> <span class="p">[])</span>
    <span class="n">re_l</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">l</span><span class="p">[</span><span class="n">ii</span><span class="p">::</span><span class="n">ncols</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncols</span><span class="p">)),</span> <span class="p">[])</span>
    <span class="c1"># reorder = lambda ll, nc: sum((ll[ii::nc] for ii in range(nc)), [])</span>
    <span class="k">return</span> <span class="n">re_h</span><span class="p">,</span> <span class="n">re_l</span></div>



<div class="viewcode-block" id="get_wakefield_data">
<a class="viewcode-back" href="../../../cavsim2d.utils.html#cavsim2d.utils.shared_functions.get_wakefield_data">[docs]</a>
<span class="k">def</span> <span class="nf">get_wakefield_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">current_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">in_electric_field_frame</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Flag to track &quot;Electric Field Lines&quot; frames</span>
        <span class="n">frame_count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Counter for Electric Field Lines frames</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;NEW FRAME&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">in_electric_field_frame</span><span class="p">:</span>
                    <span class="c1"># Store the data for the current frame before moving to the next</span>
                    <span class="k">if</span> <span class="n">current_type</span> <span class="ow">and</span> <span class="n">current_points</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Frame_</span><span class="si">{</span><span class="n">frame_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">current_type</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">current_points</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">])))</span>
                <span class="n">in_electric_field_frame</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Reset the flag when a new frame starts</span>
                <span class="n">current_points</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">current_type</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="s2">&quot;Electric Field Lines&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">in_electric_field_frame</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the flag for &quot;Electric Field Lines&quot;</span>
                <span class="n">frame_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Frame_</span><span class="si">{</span><span class="n">frame_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Initialize a new entry for the frame</span>
            <span class="k">elif</span> <span class="s2">&quot;JOIN 1&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">in_electric_field_frame</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">current_type</span> <span class="ow">and</span> <span class="n">current_points</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Frame_</span><span class="si">{</span><span class="n">frame_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">current_type</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">current_points</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">])))</span>
                <span class="n">current_type</span> <span class="o">=</span> <span class="s2">&quot;DOTS&quot;</span> <span class="k">if</span> <span class="s2">&quot;DOTS&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">else</span> <span class="s2">&quot;SOLID&quot;</span>
                <span class="n">current_points</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="n">in_electric_field_frame</span> <span class="ow">and</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s*\d\.\d+E[+-]\d+\s+\d\.\d+E[+-]\d+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                    <span class="sa">r</span><span class="s1">&#39;\s*\d\.\d+\s+\d\.\d+E[+-]\d+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)):</span>
                <span class="n">point</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[-+]?\d*\.\d+E[-+]?\d+|\d+\.\d+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)]</span>
                <span class="n">current_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

        <span class="c1"># Add the last set of points if any</span>
        <span class="k">if</span> <span class="n">in_electric_field_frame</span> <span class="ow">and</span> <span class="n">current_type</span> <span class="ow">and</span> <span class="n">current_points</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Frame_</span><span class="si">{</span><span class="n">frame_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_type</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">current_points</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">])))</span>

        <span class="k">return</span> <span class="n">data</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Sosoho-Abasi Udongwo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>